2025-06-24 17:33:22.642 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 17:33:25.452 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 17:33:25.457 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 17:33:26.337 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T12:03:25.457982 UTC.
2025-06-24 17:33:26.338 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T12:03:25.457982 UTC for 1 records.
2025-06-24 17:33:26.338 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 17:33:26.338 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 17:33:26.339 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 19:21:15.900 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 19:21:22.126 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 19:21:22.130 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 19:21:23.027 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T13:51:22.131210 UTC.
2025-06-24 19:21:23.027 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T13:51:22.131210 UTC for 1 records.
2025-06-24 19:21:23.028 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 19:21:23.028 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 19:21:23.028 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 19:45:24.722 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 19:45:28.291 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 19:45:28.321 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 19:45:29.298 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T14:15:28.382343 UTC.
2025-06-24 19:45:29.298 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T14:15:28.382343 UTC for 1 records.
2025-06-24 19:45:29.299 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 19:45:29.299 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 19:45:29.299 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 19:46:53.211 | INFO     | logging:callHandlers:1762 - Received query: 'Summarize the performance of the Batashoe112 campaign. What was its total spend and how many clicks did it get?'
2025-06-24 19:47:06.309 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 19:47:06.452 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'Summarize the performance of the Batashoe112 campaign. What was its total spend and how many clicks did it get?'
2025-06-24 19:47:16.313 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 19:55:10.220 | INFO     | logging:callHandlers:1762 - Received query: 'Which campaign generated the most link clicks? Please provide the campaign name and the exact number of link clicks.'
2025-06-24 19:55:12.533 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 19:55:12.750 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'Which campaign generated the most link clicks? Please provide the campaign name and the exact number of link clicks.'
2025-06-24 19:55:16.849 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 19:58:07.293 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-24 19:58:08.120 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 19:58:08.151 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the total spend?.'
2025-06-24 19:58:10.387 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 19:59:36.140 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-24 19:59:37.534 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 19:59:37.556 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the total spend?.'
2025-06-24 19:59:39.723 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:06:07.249 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total clicks?.'
2025-06-24 20:06:07.857 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:06:07.878 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the total clicks?.'
2025-06-24 20:06:11.189 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:06:34.572 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-24 20:06:35.326 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:06:35.327 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the total spend?.'
2025-06-24 20:06:37.353 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:06:48.475 | INFO     | logging:callHandlers:1762 - Received query: 'What is the end date ?.'
2025-06-24 20:06:49.075 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:06:49.076 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the end date ?.'
2025-06-24 20:06:51.555 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:27:06.014 | INFO     | logging:callHandlers:1762 - Received query: 'What is the future of this campaign ?.'
2025-06-24 20:27:07.010 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:27:07.703 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the future of this campaign ?.'
2025-06-24 20:27:16.194 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:28:22.655 | INFO     | logging:callHandlers:1762 - Received query: 'What is the  drawback of this campaign ?.'
2025-06-24 20:28:23.230 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:28:23.241 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the  drawback of this campaign ?.'
2025-06-24 20:28:25.816 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 20:58:44.952 | INFO     | logging:callHandlers:1762 - Received query: 'What is the  drawbakc of this campaign ?.'
2025-06-24 20:58:46.148 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 20:58:46.150 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the  drawbakc of this campaign ?.'
2025-06-24 20:58:50.927 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 21:02:36.179 | INFO     | logging:callHandlers:1762 - Received query: 'What is the  target audience of this campaign ?.'
2025-06-24 21:02:36.943 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 21:02:36.978 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the  target audience of this campaign ?.'
2025-06-24 21:02:40.128 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 21:06:38.725 | INFO     | logging:callHandlers:1762 - Received query: 'What is bat ?.'
2025-06-24 21:06:39.283 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 21:06:39.720 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is bat ?.'
2025-06-24 21:06:42.629 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:15:49.669 | INFO     | logging:callHandlers:1762 - Received query: 'What is Average cpc ?.'
2025-06-24 22:27:43.626 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 22:27:46.035 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 22:27:46.038 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 22:27:46.926 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T16:57:46.039973 UTC.
2025-06-24 22:27:46.927 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T16:57:46.039973 UTC for 1 records.
2025-06-24 22:27:46.927 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 22:27:46.927 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 22:27:46.930 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 22:27:55.631 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-24 22:28:05.010 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:28:05.011 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the total spend?.'
2025-06-24 22:28:07.610 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:28:41.919 | INFO     | logging:callHandlers:1762 - Received query: 'What is the average cpc'
2025-06-24 22:28:42.530 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:28:42.531 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the average cpc'
2025-06-24 22:28:44.621 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:29:41.136 | INFO     | logging:callHandlers:1762 - Received query: 'What is the cat'
2025-06-24 22:29:41.711 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:29:41.711 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the cat'
2025-06-24 22:29:43.959 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:31:43.021 | INFO     | logging:callHandlers:1762 - Received query: 'What is the future of this campaign and based on the present scenario of the campaign how it can be improved what is crucial metrices I should look ?'
2025-06-24 22:31:43.599 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:31:43.602 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the future of this campaign and based on the present scenario of the campaign how it can be improved what is crucial metrices I should look ?'
2025-06-24 22:31:48.652 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:34:19.906 | INFO     | logging:callHandlers:1762 - Received query: 'What is the average cost per click ?'
2025-06-24 22:34:20.499 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:34:20.502 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the average cost per click ?'
2025-06-24 22:34:22.569 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:36:35.948 | INFO     | logging:callHandlers:1762 - Received query: 'Which gender have the higher conversion rate ?.'
2025-06-24 22:36:36.528 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:36:36.530 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'Which gender have the higher conversion rate ?.'
2025-06-24 22:36:38.874 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:37:34.078 | INFO     | logging:callHandlers:1762 - Received query: 'In which region the ad is running ?.'
2025-06-24 22:37:34.656 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:37:34.657 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'In which region the ad is running ?.'
2025-06-24 22:37:37.167 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:39:18.621 | INFO     | logging:callHandlers:1762 - Received query: 'What is the cta landing page view and ctr ?.'
2025-06-24 22:39:19.200 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:39:19.201 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the cta landing page view and ctr ?.'
2025-06-24 22:39:21.587 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:39:35.476 | INFO     | logging:callHandlers:1762 - Received query: 'What is the cpa landing page view and ctr ?.'
2025-06-24 22:39:36.109 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:39:36.110 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the cpa landing page view and ctr ?.'
2025-06-24 22:39:38.329 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:41:03.425 | INFO     | logging:callHandlers:1762 - Received query: 'I am a new in ad campaign and i want a deatailed analysis of the campagin that run ?.'
2025-06-24 22:41:04.051 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:41:04.054 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'I am a new in ad campaign and i want a deatailed analysis of the campagin that run ?.'
2025-06-24 22:41:09.271 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:42:55.420 | INFO     | logging:callHandlers:1762 - Received query: 'I am a new in ad campaign and i want a deatailed analysis of the campagin that run give me with the id of the ad instead of name ?.'
2025-06-24 22:42:56.002 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:42:56.010 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'I am a new in ad campaign and i want a deatailed analysis of the campagin that run give me with the id of the ad instead of name ?.'
2025-06-24 22:42:59.903 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:50:33.592 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 22:50:35.523 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-24 22:50:39.241 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 22:50:39.243 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-24 22:50:39.266 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 22:50:39.332 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-24 22:50:41.045 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T17:20:39.405728 UTC.
2025-06-24 22:50:41.046 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T17:20:39.405728 UTC for 1 records.
2025-06-24 22:50:41.049 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 22:50:41.058 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 22:50:41.059 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 22:50:45.605 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-24T17:20:39.338693 UTC.
2025-06-24 22:50:45.606 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-24T17:20:39.338693 UTC for 1 records.
2025-06-24 22:50:45.615 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-24 22:50:45.616 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-24 22:50:45.618 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-24 22:51:05.312 | INFO     | logging:callHandlers:1762 - Received query: 'what is the cpr of my campaign which is running yesterday'
2025-06-24 22:51:06.131 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:51:06.132 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the cpr of my campaign which is running yesterday'
2025-06-24 22:51:10.013 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:53:15.411 | INFO     | logging:callHandlers:1762 - Received query: 'Can you suggest me how to improve the campagin which is ruuning?'
2025-06-24 22:53:16.006 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:53:16.007 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'Can you suggest me how to improve the campagin which is ruuning?'
2025-06-24 22:53:20.658 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:55:30.098 | INFO     | logging:callHandlers:1762 - Received query: 'How to improve my campaign can you suggest ?'
2025-06-24 22:55:30.908 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 22:55:30.911 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'How to improve my campaign can you suggest ?'
2025-06-24 22:55:35.543 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 22:59:59.802 | INFO     | logging:callHandlers:1762 - Received query: 'What is the rule i can apply for betterment of my campagin give answer in bengali ?'
2025-06-24 23:00:00.414 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 23:00:00.444 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the rule i can apply for betterment of my campagin give answer in bengali ?'
2025-06-24 23:00:07.924 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 23:00:33.429 | INFO     | logging:callHandlers:1762 - Received query: 'What is the rule i can apply for betterment of my campagin give answer in hindi ?'
2025-06-24 23:00:34.007 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 23:00:34.009 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the rule i can apply for betterment of my campagin give answer in hindi ?'
2025-06-24 23:00:40.518 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-24 23:03:19.191 | INFO     | logging:callHandlers:1762 - Received query: 'What is the rule i can apply for betterment of my campagin give answer in hindi with d9agram and chart give here  ?'
2025-06-24 23:03:19.786 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-24 23:03:19.802 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the rule i can apply for betterment of my campagin give answer in hindi with d9agram and chart give here  ?'
2025-06-24 23:03:26.892 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-25 20:17:07.209 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-25 20:17:09.523 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-25 20:17:09.525 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-25 20:17:10.109 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F53D9000; closed: -1>

psycopg2.errors.InvalidColumnReference: there is no unique or exclusion constraint matching the ON CONFLICT specification



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002A2E4505940>
    └ <WorkerThread(AnyIO worker thread, started 18884)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002A2F53E9940>
    └ <WorkerThread(AnyIO worker thread, started 18884)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002A2F539DEE0>, <sqlalchemy.orm.session.Session object at 0x000002A2F51C39...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002A2F53BDD00>

  File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>
    │    └ <function upsert_campaign_insights at 0x000002A2E99DD6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F5389AC0>
    │  └ <function Session.execute at 0x000002A2E98BE840>
    └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A2E98BE520>
           └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A2E956F100>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F5389AC0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A2E956F420>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A2E956F600>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A2E956F6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A2E956F920>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InvalidColumnReference('there is no unique or exclusion constraint matching the ON CONFLICT specification\n')
          │                    │              └ (<class 'psycopg2.errors.InvalidColumnReference'>, InvalidColumnReference('there is no unique or exclusion constraint matchin...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLIC...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F53D9000; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 9, 538707)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-25 20:17:10.788 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-25 20:17:11.076 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 9, 538707)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F53D9000; closed: -1>

psycopg2.errors.InvalidColumnReference: there is no unique or exclusion constraint matching the ON CONFLICT specification



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002A2E4505940>
    └ <WorkerThread(AnyIO worker thread, started 18884)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002A2F53E9940>
    └ <WorkerThread(AnyIO worker thread, started 18884)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002A2F539DEE0>, <sqlalchemy.orm.session.Session object at 0x000002A2F51C39...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002A2F53BDD00>

> File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>
    │    └ <function upsert_campaign_insights at 0x000002A2E99DD6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F5389AC0>
    │  └ <function Session.execute at 0x000002A2E98BE840>
    └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A2E98BE520>
           └ <sqlalchemy.orm.session.Session object at 0x000002A2F51C39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A2E956F100>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F5389AC0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A2E956F420>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A2E956F600>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A2E956F6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A2E956F920>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InvalidColumnReference('there is no unique or exclusion constraint matching the ON CONFLICT specification\n')
          │                    │              └ (<class 'psycopg2.errors.InvalidColumnReference'>, InvalidColumnReference('there is no unique or exclusion constraint matchin...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLIC...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F5418830>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F53D9000; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 9, 538707)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-25 20:17:12.253 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-25 20:17:12.255 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-25 20:17:12.826 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F55F4660; closed: -1>

psycopg2.errors.InvalidColumnReference: there is no unique or exclusion constraint matching the ON CONFLICT specification



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002A2E4505940>
    └ <WorkerThread(AnyIO worker thread, started 2196)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002A2F53E9940>
    └ <WorkerThread(AnyIO worker thread, started 2196)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002A2F539DEE0>, <sqlalchemy.orm.session.Session object at 0x000002A2F54554...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002A2F5434940>

  File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>
    │    └ <function upsert_campaign_insights at 0x000002A2E99DD6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F53DF6E0>
    │  └ <function Session.execute at 0x000002A2E98BE840>
    └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A2E98BE520>
           └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A2E956F100>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F53DF6E0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A2E956F420>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A2E956F600>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A2E956F6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A2E956F920>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InvalidColumnReference('there is no unique or exclusion constraint matching the ON CONFLICT specification\n')
          │                    │              └ (<class 'psycopg2.errors.InvalidColumnReference'>, InvalidColumnReference('there is no unique or exclusion constraint matchin...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLIC...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F55F4660; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 12, 256564)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-25 20:17:13.195 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 12, 256564)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F55F4660; closed: -1>

psycopg2.errors.InvalidColumnReference: there is no unique or exclusion constraint matching the ON CONFLICT specification



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002A2E4505940>
    └ <WorkerThread(AnyIO worker thread, started 2196)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002A2F53E9940>
    └ <WorkerThread(AnyIO worker thread, started 2196)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002A2F539DEE0>, <sqlalchemy.orm.session.Session object at 0x000002A2F54554...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002A2F5434940>

> File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>
    │    └ <function upsert_campaign_insights at 0x000002A2E99DD6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F53DF6E0>
    │  └ <function Session.execute at 0x000002A2E98BE840>
    └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002A2E98BE520>
           └ <sqlalchemy.orm.session.Session object at 0x000002A2F5455460>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x000002A2E956F100>
             └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002A2F53DF6E0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002A2E956F420>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002A2E956F600>
          └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002A2E956F6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002A2E956F920>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InvalidColumnReference('there is no unique or exclusion constraint matching the ON CONFLICT specification\n')
          │                    │              └ (<class 'psycopg2.errors.InvalidColumnReference'>, InvalidColumnReference('there is no unique or exclusion constraint matchin...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLIC...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000002A2E961A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x000002A2E99A7EC0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002A2F541B590>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002A2F55F4660; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidColumnReference) there is no unique or exclusion constraint matching the ON CONFLICT specification

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 14, 47, 12, 256564)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-25 20:18:22.639 | INFO     | logging:callHandlers:1762 - Received query: 'what is my higest sell of the campagin?'
2025-06-25 20:18:33.143 | WARNING  | logging:callHandlers:1762 - No campaign insights found in the database.
2025-06-25 20:19:48.694 | INFO     | logging:callHandlers:1762 - Received query: 'what is the cpc of the campagin'
2025-06-25 20:19:49.241 | WARNING  | logging:callHandlers:1762 - No campaign insights found in the database.
2025-06-25 20:19:52.125 | INFO     | logging:callHandlers:1762 - Received query: 'what is the cpc of the campagin'
2025-06-25 20:19:52.662 | WARNING  | logging:callHandlers:1762 - No campaign insights found in the database.
2025-06-25 20:20:06.435 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-25 20:20:06.989 | WARNING  | logging:callHandlers:1762 - No campaign insights found in the database.
2025-06-26 00:56:41.409 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 00:56:43.100 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-26 00:56:43.103 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-26 00:56:43.113 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F6D10E0; closed: -1>

psycopg2.errors.UndefinedColumn: column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001784E7D5940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001785F6E1940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001785F699EE0>, <sqlalchemy.orm.session.Session object at 0x000001785F5C39...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001785F6B9600>

  File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>
    │    └ <function upsert_campaign_insights at 0x0000017853D5D6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F6FB9B0>
    │  └ <function Session.execute at 0x0000017853C3E840>
    └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000017853C3E520>
           └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000178538EF100>
             └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F6FB9B0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000178538EF420>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000178538EF600>
          └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000178538EF6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000178538EF920>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exist\nLINE 1: ...pa_landing_page_view, cpa_thru...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exis...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist\nLINE 1...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F6D10E0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 43, 104963)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-26 00:56:43.420 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 43, 104963)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F6D10E0; closed: -1>

psycopg2.errors.UndefinedColumn: column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001784E7D5940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001785F6E1940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001785F699EE0>, <sqlalchemy.orm.session.Session object at 0x000001785F5C39...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001785F6B9600>

> File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>
    │    └ <function upsert_campaign_insights at 0x0000017853D5D6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F6FB9B0>
    │  └ <function Session.execute at 0x0000017853C3E840>
    └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000017853C3E520>
           └ <sqlalchemy.orm.session.Session object at 0x000001785F5C3950>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000178538EF100>
             └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F6FB9B0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000178538EF420>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000178538EF600>
          └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000178538EF6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000178538EF920>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exist\nLINE 1: ...pa_landing_page_view, cpa_thru...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exis...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist\nLINE 1...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F7316A0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F6D10E0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 43, 104963)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-26 00:56:49.078 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 00:56:50.430 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-26 00:56:50.442 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-26 00:56:50.476 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F8E8820; closed: -1>

psycopg2.errors.UndefinedColumn: column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001784E7D5940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001785F6E1940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001785F699EE0>, <sqlalchemy.orm.session.Session object at 0x000001785F5D8E...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001785F6BA040>

  File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>
    │    └ <function upsert_campaign_insights at 0x0000017853D5D6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F730560>
    │  └ <function Session.execute at 0x0000017853C3E840>
    └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000017853C3E520>
           └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000178538EF100>
             └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F730560>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000178538EF420>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000178538EF600>
          └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000178538EF6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000178538EF920>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exist\nLINE 1: ...pa_landing_page_view, cpa_thru...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exis...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist\nLINE 1...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F8E8820; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 50, 470068)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-26 00:56:50.534 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 50, 470068)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F8E8820; closed: -1>

psycopg2.errors.UndefinedColumn: column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001784E7D5940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001785F6E1940>
    └ <WorkerThread(AnyIO worker thread, started 22716)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001785F699EE0>, <sqlalchemy.orm.session.Session object at 0x000001785F5D8E...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001785F6BA040>

> File "D:\pubsub\main.py", line 84, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(campaign_id='23851159545550542', campaign_name='Batashoe112_Auction_LG_India_1834MF_PO123456', date_st...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>
    │    └ <function upsert_campaign_insights at 0x0000017853D5D6C0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 49, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F730560>
    │  └ <function Session.execute at 0x0000017853C3E840>
    └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000017853C3E520>
           └ <sqlalchemy.orm.session.Session object at 0x000001785F5D8EC0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x00000178538EF100>
             └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000001785F730560>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x00000178538EF420>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x00000178538EF600>
          └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x00000178538EF6A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x00000178538EF920>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exist\nLINE 1: ...pa_landing_page_view, cpa_thru...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "synced_at" of relation "campaign_insights" does not exis...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist\nLINE 1...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001785399A020>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x00000178540330E0>
    └ <sqlalchemy.engine.base.Connection object at 0x000001785F6FB710>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': ...
    │      │       └ 'INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_s...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000001785F8E8820; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "synced_at" of relation "campaign_insights" does not exist
LINE 1: ...pa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at)...
                                                             ^

[SQL: INSERT INTO campaign_insights (campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': Decimal('423.79'), 'cpc_m0': Decimal('0.089294'), 'cpm_m0': Decimal('5.28456'), 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': Decimal('1.029223'), 'clicks_m0': 4746, 'ctr_m0': Decimal('5.918148'), 'unique_clicks_m0': 4676, 'unique_ctr_m0': Decimal('6.001258'), 'outbound_clicks_m0': Decimal('1.0'), 'unique_outbound_clicks_m0': Decimal('0.0'), 'action_link_click_m0': Decimal('4809.0'), 'action_landing_page_view_m0': Decimal('0.0'), 'action_thruplay_m0': Decimal('0.0'), 'action_purchase_m0': Decimal('0.0'), 'cpa_link_click_m0': Decimal('0.088124'), 'cpa_landing_page_view_m0': Decimal('0.0'), 'cpa_thruplay_m0': Decimal('0.0'), 'cpa_purchase_m0': Decimal('0.0'), 'synced_at_m0': datetime.datetime(2025, 6, 25, 19, 26, 50, 470068)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-06-26 00:57:53.531 | INFO     | logging:callHandlers:1762 - Received query: 'what is the average cpc of the campagin?'
2025-06-26 00:58:02.046 | INFO     | logging:callHandlers:1762 - Received query: 'what is the average cpc of the campagin?'
2025-06-26 00:58:31.736 | INFO     | logging:callHandlers:1762 - Received query: 'What is the total spend?.'
2025-06-26 01:03:22.759 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 01:03:24.051 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-26 01:03:24.056 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-26 01:03:24.138 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-25T19:33:24.059003 UTC.
2025-06-26 01:03:24.139 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-25T19:33:24.059003 UTC for 1 records.
2025-06-26 01:03:24.139 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 01:03:24.140 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 01:03:24.141 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 01:03:26.103 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 01:03:27.628 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-26 01:03:27.633 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-26 01:03:27.639 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-25T19:33:27.635121 UTC.
2025-06-26 01:03:27.639 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-25T19:33:27.635121 UTC for 1 records.
2025-06-26 01:03:27.640 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 01:03:27.640 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 01:03:27.640 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 01:07:49.720 | INFO     | logging:callHandlers:1762 - Received query: 'whta is the average cpc?'
2025-06-26 01:07:50.206 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:07:50.279 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is the average cpc?'
2025-06-26 01:07:53.324 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:09:49.072 | INFO     | logging:callHandlers:1762 - Received query: 'give a summary of the campagins '
2025-06-26 01:09:49.074 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:09:49.074 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'give a summary of the campagins '
2025-06-26 01:09:51.566 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:10:51.929 | INFO     | logging:callHandlers:1762 - Received query: 'give me a future suggation of the camogain how can be it imporved ?'
2025-06-26 01:10:51.997 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:10:51.997 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'give me a future suggation of the camogain how can be it imporved ?'
2025-06-26 01:10:53.309 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:14:17.249 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 01:14:35.222 | INFO     | logging:callHandlers:1762 - 📦 Final dataframe shape: (1, 28)
2025-06-26 01:14:35.424 | INFO     | logging:callHandlers:1762 - 📦 Sample row: [{'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'campaign_id': '23851159545550542', 'spend': '423.79', 'reach': '77917', 'impressions': '80194', 'frequency': '1.029223', 'clicks': '4746', 'cpc': '0.089294', 'cpm': '5.28456', 'ctr': '5.918148', 'unique_clicks': '4676', 'unique_ctr': '6.001258', 'outbound_clicks': 1.0, 'unique_outbound_clicks': 0.0, 'action_link_click': 4809.0, 'cpa_link_click': 0.088124, 'action_landing_page_view': 0.0, 'cpa_landing_page_view': 0.0, 'action_thruplay': 0.0, 'cpa_thruplay': 0.0, 'action_purchase': 0.0, 'cpa_purchase': 0.0, 'status': 'PAUSED', 'effective_status': 'PAUSED', 'start_time': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30')}]
2025-06-26 01:14:37.229 | INFO     | logging:callHandlers:1762 - Received query: 'what is the roi of the campagin?'
2025-06-26 01:14:37.726 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:14:37.957 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the roi of the campagin?'
2025-06-26 01:14:41.244 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:14:42.116 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-25T19:44:36.708309 UTC.
2025-06-26 01:14:42.116 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-25T19:44:36.708309 UTC for 1 records.
2025-06-26 01:14:42.117 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 01:14:42.121 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 01:14:42.435 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 01:15:03.648 | INFO     | logging:callHandlers:1762 - Received query: 'what is the future of thus campagin'
2025-06-26 01:15:03.651 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:15:03.652 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the future of thus campagin'
2025-06-26 01:15:04.762 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:15:41.964 | INFO     | logging:callHandlers:1762 - Received query: 'what rule shud i imposed t make this acampgain porfitabe in future?'
2025-06-26 01:15:41.995 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:15:41.996 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what rule shud i imposed t make this acampgain porfitabe in future?'
2025-06-26 01:15:43.264 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:16:42.562 | INFO     | logging:callHandlers:1762 - Received query: 'when sombit get grifreidn(dipnwita is the gril name he like)'
2025-06-26 01:16:42.818 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 01:16:42.819 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'when sombit get grifreidn(dipnwita is the gril name he like)'
2025-06-26 01:16:43.708 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 01:55:28.645 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 01:55:29.275 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 01:55:29.438 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000140072F5940>
    └ <WorkerThread(AnyIO worker thread, started 8540)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001401822BA60>
    └ <WorkerThread(AnyIO worker thread, started 8540)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000014018228040>, <sqlalchemy.orm.session.Session object at 0x00000140182271...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001401823E940>

> File "D:\pubsub\main.py", line 65, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x000001400CCBD260>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x000001400CE6A7A0>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:24:15.571 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:24:16.711 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:24:16.713 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D0F5A25940>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001D086935D00>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001D0868FE2A0>, <sqlalchemy.orm.session.Session object at 0x000001D0869205...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001D08691D040>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x000001D0FB308EA0>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x000001D0FB4CE3E0>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:24:18.101 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:24:18.477 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:24:18.478 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D0F5A25940>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001D086935D00>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001D0868FE2A0>, <sqlalchemy.orm.session.Session object at 0x000001D08695F2...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001D08691D440>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x000001D0FB308EA0>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x000001D0FB4CE3E0>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:28:49.448 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:29:05.172 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:29:05.197 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D0F5A25940>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001D086935D00>
    └ <WorkerThread(AnyIO worker thread, started 23048)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001D0868FE2A0>, <sqlalchemy.orm.session.Session object at 0x000001D0869203...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001D086963D00>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x000001D0FB308EA0>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x000001D0FB4CE3E0>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v20.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:36:03.731 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:36:04.156 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:36:04.156 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000161B99C5940>
    └ <WorkerThread(AnyIO worker thread, started 23968)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x00000161CA94DA80>
    └ <WorkerThread(AnyIO worker thread, started 23968)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x00000161CA8E9EE0>, <sqlalchemy.orm.session.Session object at 0x00000161CA901A...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x00000161CA8FF000>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x00000161BF348720>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x00000161BF4FA020>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:38:01.593 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:38:01.953 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:38:01.954 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000027671075940>
    └ <WorkerThread(AnyIO worker thread, started 10992)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002760206D940>
    └ <WorkerThread(AnyIO worker thread, started 10992)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000027602029EE0>, <sqlalchemy.orm.session.Session object at 0x000002760201AB...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000027602044C00>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x0000027676A38680>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x0000027676BEA020>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:38:03.424 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 02:38:03.717 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 02:38:03.718 | ERROR    | logging:callHandlers:1762 - 🔥 Error in sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000027671075940>
    └ <WorkerThread(AnyIO worker thread, started 10992)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002760206D940>
    └ <WorkerThread(AnyIO worker thread, started 10992)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000027602029EE0>, <sqlalchemy.orm.session.Session object at 0x00000276020836...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002760208EB80>

> File "D:\pubsub\main.py", line 68, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x0000027676A38680>
                   └ <module 'facebook_api' from 'D:\\pubsub\\facebook_api.py'>

  File "D:\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x0000027676BEA020>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BO5ykSPJPt9Syp1j2mzpIht8yN9Au6TblrSEsqBwK2aQF47kEZCtBIF1unO718wHhlbbxBv6frhsUAxNDP7fZCCya2XZBVLiYMMSZCbgVUGdILZB6dZAmqu1ix9fS3XkH6euvoOx54ekwlZC3v6X5NUG8LHQuNPqjNEePCKGUsq96Wpnc26EK8Fm8d3CIcU8mcZBJIZCuK&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-06-26 20:50:26.491 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 20:50:29.824 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-26T15:20:29.719491 UTC.
2025-06-26 20:50:29.824 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-26T15:20:29.719491 UTC for 1 records.
2025-06-26 20:50:29.826 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 20:50:29.826 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 20:50:29.827 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 20:51:37.367 | INFO     | logging:callHandlers:1762 - Received query: 'whta is my average cpc of the campaign?'
2025-06-26 20:51:37.369 | INFO     | logging:callHandlers:1762 - Using business context: {'business_objective': 'string', 'target_roas': 0.0, 'target_cpa': 0.0, 'ideal_customer_profile': 'string'}
2025-06-26 20:51:37.680 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 20:51:37.681 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is my average cpc of the campaign?'
2025-06-26 20:51:45.545 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 20:53:22.937 | INFO     | logging:callHandlers:1762 - Received query: 'whta is my average cpc of the campaign?'
2025-06-26 20:53:22.938 | INFO     | logging:callHandlers:1762 - Using business context: {'business_objective': 'to grow in near future', 'target_roas': 0.0, 'target_cpa': 0.0, 'ideal_customer_profile': 'Gen-Z'}
2025-06-26 20:53:22.941 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 20:53:22.942 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is my average cpc of the campaign?'
2025-06-26 20:53:26.927 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 21:10:46.063 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 21:10:48.244 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-26T15:40:48.150595 UTC.
2025-06-26 21:10:48.245 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-26T15:40:48.150595 UTC for 1 records.
2025-06-26 21:10:48.246 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 21:10:48.246 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 21:10:48.247 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 21:10:50.561 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-26 21:10:52.176 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-26T15:40:52.173312 UTC.
2025-06-26 21:10:52.177 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-26T15:40:52.173312 UTC for 1 records.
2025-06-26 21:10:52.177 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-26 21:10:52.177 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-26 21:10:52.178 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-26 21:11:24.509 | INFO     | logging:callHandlers:1762 - Received query: 'what is the average cpc of thw campagin?'
2025-06-26 21:11:24.665 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 21:11:24.665 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the average cpc of thw campagin?'
2025-06-26 21:11:30.673 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 21:13:04.379 | INFO     | logging:callHandlers:1762 - Received query: 'what is the suggetsion to make the campagi profitabke in near future'
2025-06-26 21:13:04.381 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 21:13:04.382 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the suggetsion to make the campagi profitabke in near future'
2025-06-26 21:13:09.201 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 21:18:32.495 | INFO     | logging:callHandlers:1762 - Received query: 'What is the attribution window of so and so campaign?'
2025-06-26 21:18:34.133 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 21:18:34.272 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the attribution window of so and so campaign?'
2025-06-26 21:18:42.915 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 21:20:51.565 | INFO     | logging:callHandlers:1762 - Received query: 'how is so and so campaign performing? give me complete overview'
2025-06-26 21:20:51.858 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 21:20:51.870 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'how is so and so campaign performing? give me complete overview'
2025-06-26 21:20:57.641 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:31:52.632 | INFO     | logging:callHandlers:1762 - Received query: 'what is the ROI of the campagin?'
2025-06-26 22:31:53.749 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:31:53.867 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the ROI of the campagin?'
2025-06-26 22:32:01.239 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:36:22.037 | INFO     | logging:callHandlers:1762 - Received query: 'I am a digital marketing coach who sell digital courses I am based of india pls suggest me how can generate buisness using metaads?'
2025-06-26 22:36:22.248 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:36:22.506 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'I am a digital marketing coach who sell digital courses I am based of india pls suggest me how can generate buisness using metaads?'
2025-06-26 22:36:31.701 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:44:25.927 | INFO     | logging:callHandlers:1762 - Received query: 'What is the potentail risk i can faced in near future?'
2025-06-26 22:44:26.138 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:44:26.156 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the potentail risk i can faced in near future?'
2025-06-26 22:44:33.283 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:45:30.723 | INFO     | logging:callHandlers:1762 - Received query: 'What is the potentail risk i can faced in near future give answer in hindi?'
2025-06-26 22:45:30.738 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:45:30.765 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the potentail risk i can faced in near future give answer in hindi?'
2025-06-26 22:45:37.316 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:46:44.059 | INFO     | logging:callHandlers:1762 - Received query: 'What is the potentail risk i can faced in near future give answer in bengali?'
2025-06-26 22:46:44.063 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:46:44.096 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'What is the potentail risk i can faced in near future give answer in bengali?'
2025-06-26 22:46:57.554 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-26 22:52:26.282 | INFO     | logging:callHandlers:1762 - Received query: 'give a summaey of the campagon?'
2025-06-26 22:52:26.284 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-26 22:52:26.365 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'give a summaey of the campagon?'
2025-06-26 22:52:31.702 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 21:40:51.006 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 21:40:53.276 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-27T16:10:53.209189 UTC.
2025-06-27 21:40:53.277 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-27T16:10:53.209189 UTC for 1 records.
2025-06-27 21:40:53.278 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-27 21:40:53.278 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-27 21:40:53.279 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 21:40:53.384 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 21:40:54.968 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records at 2025-06-27T16:10:54.964450 UTC.
2025-06-27 21:40:54.968 | INFO     | logging:callHandlers:1762 - 🧾 Upsert committed at 2025-06-27T16:10:54.964450 UTC for 1 records.
2025-06-27 21:40:54.968 | INFO     | logging:callHandlers:1762 - 🧾 Upserting 1 records...
2025-06-27 21:40:54.969 | INFO     | logging:callHandlers:1762 - 🧾 Sample record keys: ['campaign_id', 'campaign_name', 'date_start', 'date_stop', 'start_time', 'stop_time', 'status', 'effective_status', 'spend', 'reach', 'impressions', 'frequency', 'clicks', 'cpc', 'cpm', 'ctr', 'unique_clicks', 'unique_ctr', 'outbound_clicks', 'unique_outbound_clicks', 'action_link_click', 'action_landing_page_view', 'action_thruplay', 'action_purchase', 'cpa_link_click', 'cpa_landing_page_view', 'cpa_thruplay', 'cpa_purchase', 'synced_at']
2025-06-27 21:40:54.969 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 21:42:54.856 | INFO     | logging:callHandlers:1762 - Received strategist query: 'Hey I have a buiness of online courses and i want to marketing mty buisness thhirugh ads in kolkata and my targte audeinfe is college sturnets and also can yu suggest for imstail if i have small budget of 10k then which ad plafrm i hae ti choose and how the thungs i have ti follow ti get succesful camoguan rrunning?'
2025-06-27 21:42:54.860 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to Strategist LLM for query: 'Hey I have a buiness of online courses and i want to marketing mty buisness thhirugh ads in kolkata and my targte audeinfe is college sturnets and also can yu suggest for imstail if i have small budget of 10k then which ad plafrm i hae ti choose and how the thungs i have ti follow ti get succesful camoguan rrunning?'
2025-06-27 21:43:01.497 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from Strategist LLM.
2025-06-27 21:46:37.091 | INFO     | logging:callHandlers:1762 - Received strategist query: 'based on the prevouus dicsussing can you sugess hsouf i go for =facebook ads or gads platrofme ??'
2025-06-27 21:46:37.093 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to Strategist LLM for query: 'based on the prevouus dicsussing can you sugess hsouf i go for =facebook ads or gads platrofme ??'
2025-06-27 21:46:39.123 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from Strategist LLM.
2025-06-27 22:02:48.161 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 22:02:49.701 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-27 22:02:49.701 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 22:03:30.820 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is the average cpc of the campagin?'
2025-06-27 22:03:30.963 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-27 22:03:30.964 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is the average cpc of the campagin?'
2025-06-27 22:03:36.697 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:08:48.194 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i have a buisness of fastfood and i want to run ad for expand of my buisness so ehuch ad platrom i hiud choose?' for conversation ID: 1
2025-06-27 22:08:48.222 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:08:51.609 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:12:43.666 | INFO     | logging:callHandlers:1762 - Received strategist query: 'okay based on my prevous talk my resuturnet in kolkat an d my target audience is gen-zee and want to exapldn my buisness more my budget is 50k' for conversation ID: 1
2025-06-27 22:12:43.731 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:12:48.123 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:14:02.176 | INFO     | logging:callHandlers:1762 - Received strategist query: 'can you jst tell me what is my business idea based in the previous talks?' for conversation ID: 1
2025-06-27 22:14:02.238 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:14:03.385 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:14:23.714 | INFO     | logging:callHandlers:1762 - Received strategist query: 'can you jst tell me what is my business idea based in the previous talks?' for conversation ID: 0
2025-06-27 22:14:23.721 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:14:25.121 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:14:35.530 | INFO     | logging:callHandlers:1762 - Received strategist query: 'can you jst tell me what is my business idea based in the previous talks?' for conversation ID: 2
2025-06-27 22:14:35.537 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:14:36.401 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:14:42.572 | INFO     | logging:callHandlers:1762 - Received strategist query: 'can you jst tell me what is my business idea based in the previous talks?' for conversation ID: 1
2025-06-27 22:14:42.611 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:14:43.700 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:20:25.967 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 22:20:31.645 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-27 22:20:31.646 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 22:21:30.727 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i have a buisness of fastfood and i want to run ad for expand of my buisness so ehuch ad platrom i shiud choose?' for conversation ID: None
2025-06-27 22:21:30.733 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:21:34.836 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:24:28.800 | INFO     | logging:callHandlers:1762 - Received strategist query: 'based on the previous  talk if i want to run ad in kolkata on food how much gain i can expect frem this region for my buisness' for conversation ID: 3
2025-06-27 22:24:28.906 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:24:32.273 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:25:56.247 | INFO     | logging:callHandlers:1762 - Received strategist query: 'what shoild be my strategy to run a fasyfood buisnes in kolkata' for conversation ID: 3
2025-06-27 22:25:56.254 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:26:01.719 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:27:30.729 | INFO     | logging:callHandlers:1762 - Received strategist query: 'give sort precise answer' for conversation ID: 3
2025-06-27 22:27:30.735 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:27:32.316 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:29:13.275 | INFO     | logging:callHandlers:1762 - Received strategist query: 'Develop a comprehensive business plan that outlines your financial projections, marketing strategy, and operational plan.' for conversation ID: 3
2025-06-27 22:29:13.313 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:29:19.436 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:31:09.930 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 22:31:12.358 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-27 22:31:12.359 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 22:31:39.775 | INFO     | logging:callHandlers:1762 - Received strategist query: 'okay now comming to my camogan that us tire in my datav=base based on that ehat s the averag cpc ?' for conversation ID: 3
2025-06-27 22:31:39.786 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 22:31:42.181 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:32:02.290 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'okay now comming to my camogan that us tire in my datav=base based on that ehat s the averag cpc ?'
2025-06-27 22:32:03.259 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-27 22:32:03.350 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'okay now comming to my camogan that us tire in my datav=base based on that ehat s the averag cpc ?'
2025-06-27 22:32:09.564 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 22:33:11.847 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-27 22:33:13.741 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-27 22:33:13.742 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-27 23:08:18.140 | INFO     | logging:callHandlers:1762 - Received strategist query: 'what is the booing buisness iin niw and what platrom  i can choose for rum my ad' for conversation ID: None
2025-06-27 23:08:18.455 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 23:08:21.465 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 23:08:34.867 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i said booming' for conversation ID: 4
2025-06-27 23:08:34.890 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 23:08:37.437 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 23:11:24.334 | INFO     | logging:callHandlers:1762 - Received strategist query: 'how should i create a campgain in meta?' for conversation ID: None
2025-06-27 23:11:24.531 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 23:11:28.054 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 23:13:28.024 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i have a boutinq jewelwrry which i am ruinning only west bengal and i my targte audenices are female of 20 to 28 and i habe interested in jeweleries' for conversation ID: 5
2025-06-27 23:13:28.127 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 23:13:32.832 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-27 23:14:17.178 | INFO     | logging:callHandlers:1762 - Received strategist query: 'boutique jewellery business' for conversation ID: 5
2025-06-27 23:14:17.353 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-27 23:14:22.974 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-28 00:13:31.991 | INFO     | logging:callHandlers:1762 - Received strategist query: '“What metrics should I track to measure Meta Ads ROI?”' for conversation ID: None
2025-06-28 00:13:34.897 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-28 00:13:43.662 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-28 00:16:50.270 | INFO     | logging:callHandlers:1762 - Received strategist query: 'based on the previous qustion if i have a jewellery buiness based in kolkata and my targte audine is female if age goru 20 to 28 then waht shiud be my probabke future ROi if we hae=ve the bysgte of 50k for running our ad in meta' for conversation ID: 6
2025-06-28 00:16:50.514 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-28 00:16:56.977 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-28 00:21:41.412 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-28 00:21:44.697 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-28 00:21:44.697 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-28 00:21:54.610 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is my camogain budget?'
2025-06-28 00:21:54.830 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-28 00:21:54.848 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'what is my camogain budget?'
2025-06-28 00:22:00.875 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-28 00:24:51.206 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-28 00:24:52.893 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-28 00:24:52.894 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-28 00:26:39.037 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-28 00:26:40.494 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-28 00:26:40.496 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-28 00:26:57.860 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-28 00:26:59.477 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-28 00:26:59.478 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 10:55:08.339 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 10:55:21.910 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 10:55:21.911 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 10:55:32.948 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 10:55:34.200 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 10:55:34.203 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 10:56:48.463 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 10:56:49.782 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 10:56:49.783 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 10:59:14.718 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i have a boutique jewellery business in kolkata give me a suggetsion r step by steo camgain running rocesss how can  run ads fkr expaknd mybusiness' for conversation ID: None
2025-06-30 10:59:17.266 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 10:59:19.362 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 11:00:01.302 | INFO     | logging:callHandlers:1762 - Received strategist query: 'it's a sr boutique jewellry busniness' for conversation ID: 7
2025-06-30 11:00:01.358 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:00:04.407 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 58
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029437...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029437...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029437...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F196C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '69', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F196C0>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000029437F8CB00>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A660>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A660>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A660>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A660>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000029437F8D910>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029437F1A7A0>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A8E0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029437F1A7A0>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000029437F8D910>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000029437C9C170>, 'request': StrategistQueryRequest(query="it's a sr bout...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ "it's a sr boutique jewellry busniness"
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x0000029437FEFA60>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 58
}
]
2025-06-30 11:01:00.029 | INFO     | logging:callHandlers:1762 - Received strategist query: 'give ans' for conversation ID: 7
2025-06-30 11:01:00.078 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:01:01.525 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 11:01:25.465 | INFO     | logging:callHandlers:1762 - Received strategist query: 'no justa boutique jewellery business' for conversation ID: 7
2025-06-30 11:01:25.668 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:01:26.089 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 33
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000294383758A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '68', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000294383758A0>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000029438361F70>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438374C20>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438374C20>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438374C20>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438374C20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438374C20>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000029438362930>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029438374D60>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000294383756C0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029438374D60>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000029438362930>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000029438002B70>, 'request': StrategistQueryRequest(query='no justa bouti...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ 'no justa boutique jewellery business'
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x0000029438375F80>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 33
}
]
2025-06-30 11:01:43.744 | INFO     | logging:callHandlers:1762 - Received strategist query: 'it just a boutinue jewellery business' for conversation ID: 7
2025-06-30 11:01:43.748 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:01:44.086 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 15
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F1A5C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '69', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F1A5C0>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000029438363BC0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A840>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A840>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A840>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A840>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437F1A840>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000029438362D80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029437F1A700>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFCE0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029437F1A700>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000029438362D80>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000029437FD37D0>, 'request': StrategistQueryRequest(query='it just a bout...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ 'it just a boutinue jewellery business'
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x00000294383759E0>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 15
}
]
2025-06-30 11:01:48.275 | INFO     | logging:callHandlers:1762 - Received strategist query: 'give ans' for conversation ID: 7
2025-06-30 11:01:48.281 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:01:48.642 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 11
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029438375080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '40', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029438375080>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000294383C4110>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375580>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375580>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375580>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375580>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375580>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000294383C4290>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029438374FE0>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438375BC0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029438374FE0>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000294383C4290>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000029438361370>, 'request': StrategistQueryRequest(query='give ans', con...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ 'give ans'
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x0000029438376480>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 11
}
]
2025-06-30 11:01:52.167 | INFO     | logging:callHandlers:1762 - Received strategist query: 'give ans' for conversation ID: 7
2025-06-30 11:01:52.177 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:01:52.509 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 7
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F1A5C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '40', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029437F1A5C0>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000029438360980>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFD80>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFD80>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFD80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFD80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029437FEFD80>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000029438360D70>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029437FEF920>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029429618220>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029437FEF920>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000029438360D70>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x00000294380019A0>, 'request': StrategistQueryRequest(query='give ans', con...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ 'give ans'
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x0000029438374EA0>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 7
}
]
2025-06-30 11:02:09.255 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i have a boutique jewellery business in kolkata give me a suggetsion r step by steo camgain running rocesss how can run ads fkr expaknd mybusiness' for conversation ID: None
2025-06-30 11:02:09.262 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 11:02:09.653 | ERROR    | logging:callHandlers:1762 - 🔥 An error occurred while communicating with the LLM: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 50
}
]
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002942716ADE0>
  File "C:\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002942706F240>
           └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002942706E7A0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002942711BC50>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
    │    └ <function subprocess_started at 0x00000294294CA980>
    └ <SpawnProcess name='SpawnProcess-1' parent=4024 started>
  File "C:\Python312\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000029429606420>>
  File "C:\Python312\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000294294CA020>
           │       │   └ <uvicorn.server.Server object at 0x0000029429606420>
           │       └ <function run at 0x0000029428CE7560>
           └ <module 'asyncio' from 'C:\\Python312\\Lib\\asyncio\\__init__.py'>
  File "C:\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002942960D8C0>
           │      └ <function Runner.run at 0x0000029428D959E0>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Python312\Lib\site-packages\uvicorn\server.py:70> wait_for=<Fu...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000029428D8B600>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000029429504590>
  File "C:\Python312\Lib\asyncio\base_events.py", line 674, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000029428D8B560>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 641, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000029428D953A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Python312\Lib\asyncio\base_events.py", line 1986, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000029428CCF920>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Task finishe...grpc.aio.EOF>>)>
  File "C:\Python312\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002942965FBF0>
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029438...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
          └ <fastapi.applications.FastAPI object at 0x0000029437409D30>
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029438376700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000029437EF7800>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '158', 'sec-ch-ua-platform': '"Windows"', 'u...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000029438376700>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x000002942C53EFC0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980>
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000029437EF7980...
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000029438360F80>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000029437EF7470>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438377060>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438377060>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000029437BB1280>>
          └ <fastapi.routing.APIRouter object at 0x0000029437BB1280>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438377060>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002942B6D1A80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438377060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000029437F19B20>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438377060>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000029438002AB0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000029438376F20>
          └ <function wrap_app_handling_exceptions at 0x000002942706F880>
  File "C:\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000029438376C00>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000029...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000029438376F20>
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000029438002AB0>
                     └ <function get_request_handler.<locals>.app at 0x0000029437F199E0>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002942B6D0400>
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000029438362F30>, 'request': StrategistQueryRequest(query='i have a bouti...
                 │         └ <function ask_marketing_strategist at 0x0000029437F18FE0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\pubsub\main.py", line 141, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000029434F058A0>
                             └ <module 'strategist_llm_service' from 'D:\\pubsub\\strategist_llm_service.py'>

> File "D:\pubsub\strategist_llm_service.py", line 70, in get_strategist_response
    response = await chat.send_message_async(query)
                     │    │                  └ 'i have a boutique jewellery business in kolkata give me a suggetsion r step by steo camgain running rocesss how can run ads ...
                     │    └ <function ChatSession.send_message_async at 0x0000029437E1A8E0>
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...

  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 707, in send_message_async
    response = await self.model.generate_content_async(
                     │    │     └ <function GenerativeModel.generate_content_async at 0x0000029437E1A340>
                     │    └ genai.GenerativeModel(
                     │          model_name='models/gemini-1.5-flash',
                     │          generation_config={},
                     │          safety_settings={},
                     │          tools=...
                     └ ChatSession(
                           model=genai.GenerativeModel(
                               model_name='models/gemini-1.5-flash',
                               generation_config={},
                          ...
  File "C:\Python312\Lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
                     │    │             └ <function GenerativeServiceAsyncClient.generate_content at 0x00000294358DEB60>
                     │    └ <google.ai.generativelanguage_v1beta.services.generative_service.async_client.GenerativeServiceAsyncClient object at 0x000002...
                     └ genai.GenerativeModel(
                           model_name='models/gemini-1.5-flash',
                           generation_config={},
                           safety_settings={},
                           tools=...
  File "C:\Python312\Lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
                     └ <google.api_core.gapic_v1.method._GapicCallable object at 0x0000029437EF6900>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 230, in retry_wrapped_func
    return await retry_target(
                 └ <function retry_target at 0x0000029435268F40>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 160, in retry_target
    _retry_error_helper(
    └ <function _retry_error_helper at 0x0000029435268860>
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_base.py", line 212, in _retry_error_helper
    raise final_exc from source_exc
          │              └ None
          └ ResourceExhausted('You exceeded your current quota, please check your plan and billing details. For more information on this ...
  File "C:\Python312\Lib\site-packages\google\api_core\retry\retry_unary_async.py", line 155, in retry_target
    return await target()
                 └ functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x00000294383765C0>, model: "models/gemini...
  File "C:\Python312\Lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
          │          └ <function from_grpc_error at 0x0000029435236520>
          └ <module 'google.api_core.exceptions' from 'C:\\Python312\\Lib\\site-packages\\google\\api_core\\exceptions.py'>

google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 50
}
]
2025-06-30 13:42:26.482 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 13:42:40.293 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 13:42:55.287 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 13:42:55.287 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 13:42:56.343 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 13:42:56.344 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 13:44:56.705 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I have a buiensess of jewelley and u enat ti run camoagin guide me thurgh tis i enat run my buisness in gads' for conversation ID: None
2025-06-30 13:44:59.116 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:45:00.696 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:45:20.130 | INFO     | logging:callHandlers:1762 - Received strategist query: 'i wnat to run business in google ads' for conversation ID: 9
2025-06-30 13:45:20.148 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:45:21.533 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:47:10.744 | INFO     | logging:callHandlers:1762 - Received strategist query: 'okay then give me the meta ads approach' for conversation ID: 9
2025-06-30 13:47:10.926 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:47:12.007 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:47:29.358 | INFO     | logging:callHandlers:1762 - Received strategist query: 'gold jewellery' for conversation ID: 9
2025-06-30 13:47:29.373 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:47:31.936 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:47:52.057 | INFO     | logging:callHandlers:1762 - Received strategist query: 'pure gild with elegenat deisgn' for conversation ID: 9
2025-06-30 13:47:52.065 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:47:53.682 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:48:11.784 | INFO     | logging:callHandlers:1762 - Received strategist query: 'girls of age 25 to 45' for conversation ID: 9
2025-06-30 13:48:11.790 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:48:12.930 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:48:29.199 | INFO     | logging:callHandlers:1762 - Received strategist query: 'all kind of' for conversation ID: 9
2025-06-30 13:48:29.208 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:48:30.726 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:48:57.363 | INFO     | logging:callHandlers:1762 - Received strategist query: 'house wife' for conversation ID: 9
2025-06-30 13:48:57.375 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:48:58.552 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:49:07.144 | INFO     | logging:callHandlers:1762 - Received strategist query: 'kolkata' for conversation ID: 9
2025-06-30 13:49:07.177 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:49:08.451 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:49:24.169 | INFO     | logging:callHandlers:1762 - Received strategist query: 'all' for conversation ID: 9
2025-06-30 13:49:24.178 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:49:25.791 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:49:48.556 | INFO     | logging:callHandlers:1762 - Received strategist query: 'slaes' for conversation ID: 9
2025-06-30 13:49:48.567 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:49:49.766 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:50:02.105 | INFO     | logging:callHandlers:1762 - Received strategist query: 'yes' for conversation ID: 9
2025-06-30 13:50:02.120 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:50:03.254 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:50:09.433 | INFO     | logging:callHandlers:1762 - Received strategist query: '50k' for conversation ID: 9
2025-06-30 13:50:09.541 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:50:10.887 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:50:20.941 | INFO     | logging:callHandlers:1762 - Received strategist query: 'no' for conversation ID: 9
2025-06-30 13:50:20.947 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:50:22.180 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:50:39.425 | INFO     | logging:callHandlers:1762 - Received strategist query: 'no gude me frm scratch' for conversation ID: 9
2025-06-30 13:50:39.429 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:50:43.333 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:51:20.775 | INFO     | logging:callHandlers:1762 - Received strategist query: 'anajalijeweleers' for conversation ID: 9
2025-06-30 13:51:20.818 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:51:22.124 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:51:29.977 | INFO     | logging:callHandlers:1762 - Received strategist query: 'anjalli jewellers' for conversation ID: 9
2025-06-30 13:51:30.017 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:51:31.523 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:52:02.427 | INFO     | logging:callHandlers:1762 - Received strategist query: 'offers first cyeimer 25% off' for conversation ID: 9
2025-06-30 13:52:02.434 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:52:03.745 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:52:15.190 | INFO     | logging:callHandlers:1762 - Received strategist query: 'right now' for conversation ID: 9
2025-06-30 13:52:15.205 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-06-30 13:52:18.494 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:57:00.823 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 13:57:02.979 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 13:57:02.981 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-06-30 13:57:09.989 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'whta is the avergae cpc?'
2025-06-30 13:57:13.204 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-06-30 13:57:13.385 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is the avergae cpc?'
2025-06-30 13:57:21.684 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-06-30 13:57:21.852 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-06-30 13:57:23.256 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-06-30 13:57:23.257 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-07-01 15:09:50.753 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 15:09:52.541 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA33E60; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6C97AA...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6C9B5D00>

  File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C4155E0>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C4155E0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA33E60; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 39, 52, 473951)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:09:53.285 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 39, 52, 473951)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA33E60; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6C97AA...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6C9B5D00>

> File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C4155E0>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6C97AAB0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C4155E0>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA0B2F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA33E60; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 39, 52, 473951)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:12:56.839 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 15:12:58.271 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA519A0; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6CA084...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6C9B5880>

  File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C389E80>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C389E80>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA519A0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 42, 58, 268147)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:12:58.280 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 42, 58, 268147)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA519A0; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6CA084...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6C9B5880>

> File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C389E80>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08470>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C389E80>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6CA43920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA519A0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 42, 58, 268147)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:12:59.391 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 15:13:00.767 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA512A0; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6CA4EEC0>

  File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C97B650>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C97B650>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA512A0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 43, 0, 762803)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:13:00.797 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 43, 0, 762803)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA512A0; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022D5BABD940>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000022D6C9F45E0>
    └ <WorkerThread(AnyIO worker thread, started 2148)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x0000022D6C99C680>, <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000022D6CA4EEC0>

> File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>
    │    └ <function upsert_campaign_insights at 0x0000022D610200E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C97B650>
    │  └ <function Session.execute at 0x0000022D60EF96C0>
    └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022D60EF93A0>
           └ <sqlalchemy.orm.session.Session object at 0x0000022D6CA08F20>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022D60BA1F80>
             └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x0000022D6C97B650>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022D60BA22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022D60BA2480>
          └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022D60BA2520>
           └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022D60BA27A0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022D60C50EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000022D612F64E0>
    └ <sqlalchemy.engine.base.Connection object at 0x0000022D6C9D39E0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x0000022D6CA512A0; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 9, 43, 0, 762803)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:37:24.145 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 15:37:25.978 | ERROR    | logging:callHandlers:1762 - 🔥 Database upsert failed:
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000240018F0EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000024001F79850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002400D763E60; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002407C61D940>
    └ <WorkerThread(AnyIO worker thread, started 11348)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002400D7205E0>
    └ <WorkerThread(AnyIO worker thread, started 11348)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002400D6CC680>, <sqlalchemy.orm.session.Session object at 0x000002400D6D02...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002400D6E6980>

  File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>
    │    └ <function upsert_campaign_insights at 0x0000024001CC00E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

> File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002400D6A7350>
    │  └ <function Session.execute at 0x0000024001B996C0>
    └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000024001B993A0>
           └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000024001849F80>
             └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002400D6A7350>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002400184A2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002400184A480>
          └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002400184A520>
           └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002400184A7A0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000240018F0EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000024001F79850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002400D763E60; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 10, 7, 25, 972821)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:37:25.996 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 10, 7, 25, 972821)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):

  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000240018F0EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000024001F79850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002400D763E60; closed: -1>

psycopg2.errors.UndefinedColumn: column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^



The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002407C61D940>
    └ <WorkerThread(AnyIO worker thread, started 11348)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000002400D7205E0>
    └ <WorkerThread(AnyIO worker thread, started 11348)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000002400D6CC680>, <sqlalchemy.orm.session.Session object at 0x000002400D6D02...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000002400D6E6980>

> File "D:\pubsub\main.py", line 73, in sync_data_task
    crud.upsert_campaign_insights(db, insights=insights_to_upsert)
    │    │                        │            └ [CampaignInsightCreate(ad_account_id='act_244007880249554', campaign_id='23851159545550542', date_start=Timestamp('2022-08-21...
    │    │                        └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>
    │    └ <function upsert_campaign_insights at 0x0000024001CC00E0>
    └ <module 'crud' from 'D:\\pubsub\\crud.py'>

  File "D:\pubsub\crud.py", line 46, in upsert_campaign_insights
    db.execute(on_conflict_stmt)
    │  │       └ <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002400D6A7350>
    │  └ <function Session.execute at 0x0000024001B996C0>
    └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>

  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2362, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000024001B993A0>
           └ <sqlalchemy.orm.session.Session object at 0x000002400D6D02F0>
  File "C:\Python312\Lib\site-packages\sqlalchemy\orm\session.py", line 2256, in _execute_internal
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000024001849F80>
             └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1418, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.dialects.postgresql.dml.Insert object at 0x000002400D6A7350>>
  File "C:\Python312\Lib\site-packages\sqlalchemy\sql\elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000002400184A2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000002400184A480>
          └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000002400184A520>
           └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000002400184A7A0>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not exist\nLINE 1: INSERT INTO campaign_insights...
          │                    │              └ (<class 'psycopg2.errors.UndefinedColumn'>, UndefinedColumn('column "ad_account_id" of relation "campaign_insights" does not ...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist\nLI...
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x00000240018F0EA0>
    │    └ <sqlalchemy.dialects.postgresql.psycopg2.PGDialect_psycopg2 object at 0x0000024001F79850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002400D734920>
  File "C:\Python312\Lib\site-packages\sqlalchemy\engine\default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_L...
    │      │       └ 'INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, stat...
    │      └ <method 'execute' of 'psycopg2.extensions.cursor' objects>
    └ <cursor object at 0x000002400D763E60; closed: -1>

sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "ad_account_id" of relation "campaign_insights" does not exist
LINE 1: INSERT INTO campaign_insights (ad_account_id, campaign_id, c...
                                       ^

[SQL: INSERT INTO campaign_insights (ad_account_id, campaign_id, campaign_name, date_start, date_stop, start_time, stop_time, status, effective_status, spend, cpc, cpm, reach, impressions, frequency, clicks, ctr, unique_clicks, unique_ctr, outbound_clicks, unique_outbound_clicks, action_link_click, action_landing_page_view, action_thruplay, action_purchase, cpa_link_click, cpa_landing_page_view, cpa_thruplay, cpa_purchase, synced_at) VALUES (%(ad_account_id_m0)s, %(campaign_id_m0)s, %(campaign_name_m0)s, %(date_start_m0)s, %(date_stop_m0)s, %(start_time_m0)s, %(stop_time_m0)s, %(status_m0)s, %(effective_status_m0)s, %(spend_m0)s, %(cpc_m0)s, %(cpm_m0)s, %(reach_m0)s, %(impressions_m0)s, %(frequency_m0)s, %(clicks_m0)s, %(ctr_m0)s, %(unique_clicks_m0)s, %(unique_ctr_m0)s, %(outbound_clicks_m0)s, %(unique_outbound_clicks_m0)s, %(action_link_click_m0)s, %(action_landing_page_view_m0)s, %(action_thruplay_m0)s, %(action_purchase_m0)s, %(cpa_link_click_m0)s, %(cpa_landing_page_view_m0)s, %(cpa_thruplay_m0)s, %(cpa_purchase_m0)s, %(synced_at_m0)s) ON CONFLICT (campaign_id, date_start) DO UPDATE SET ad_account_id = excluded.ad_account_id, campaign_name = excluded.campaign_name, date_stop = excluded.date_stop, start_time = excluded.start_time, stop_time = excluded.stop_time, status = excluded.status, effective_status = excluded.effective_status, spend = excluded.spend, cpc = excluded.cpc, cpm = excluded.cpm, reach = excluded.reach, impressions = excluded.impressions, frequency = excluded.frequency, clicks = excluded.clicks, ctr = excluded.ctr, unique_clicks = excluded.unique_clicks, unique_ctr = excluded.unique_ctr, outbound_clicks = excluded.outbound_clicks, unique_outbound_clicks = excluded.unique_outbound_clicks, action_link_click = excluded.action_link_click, action_landing_page_view = excluded.action_landing_page_view, action_thruplay = excluded.action_thruplay, action_purchase = excluded.action_purchase, cpa_link_click = excluded.cpa_link_click, cpa_landing_page_view = excluded.cpa_landing_page_view, cpa_thruplay = excluded.cpa_thruplay, cpa_purchase = excluded.cpa_purchase, synced_at = now()]
[parameters: {'ad_account_id_m0': 'act_244007880249554', 'campaign_id_m0': '23851159545550542', 'campaign_name_m0': 'Batashoe112_Auction_LG_India_1834MF_PO123456', 'date_start_m0': Timestamp('2022-08-21 00:00:00'), 'date_stop_m0': Timestamp('2022-09-30 00:00:00'), 'start_time_m0': Timestamp('2022-08-21 12:29:04+0530', tz='UTC+05:30'), 'stop_time_m0': Timestamp('2022-09-02 23:59:43+0530', tz='UTC+05:30'), 'status_m0': 'PAUSED', 'effective_status_m0': 'PAUSED', 'spend_m0': 423.79, 'cpc_m0': 0.089294, 'cpm_m0': 5.28456, 'reach_m0': 77917, 'impressions_m0': 80194, 'frequency_m0': 1.029223, 'clicks_m0': 4746, 'ctr_m0': 5.918148, 'unique_clicks_m0': 4676, 'unique_ctr_m0': 6.001258, 'outbound_clicks_m0': 1.0, 'unique_outbound_clicks_m0': 0.0, 'action_link_click_m0': 4809.0, 'action_landing_page_view_m0': 0.0, 'action_thruplay_m0': 0.0, 'action_purchase_m0': 0.0, 'cpa_link_click_m0': 0.088124, 'cpa_landing_page_view_m0': 0.0, 'cpa_thruplay_m0': 0.0, 'cpa_purchase_m0': 0.0, 'synced_at_m0': datetime.datetime(2025, 7, 1, 10, 7, 25, 972821)}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-07-01 15:55:07.241 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 15:55:09.366 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 15:55:09.366 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete.
2025-07-01 17:37:47.640 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync...
2025-07-01 17:37:49.864 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: 1 validation error for CampaignInsightCreate
user_id
  Field required [type=missing, input_value={'date_start': Timestamp(...: 'act_244007880249554'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001850BF4D940>
    └ <WorkerThread(AnyIO worker thread, started 26372)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001851CE472E0>
    └ <WorkerThread(AnyIO worker thread, started 26372)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ functools.partial(<function sync_data_task at 0x000001851CE27380>, <sqlalchemy.orm.session.Session object at 0x000001851CE4E2...
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001851CE57A40>

> File "D:\pubsub\main.py", line 73, in sync_data_task
    insights_to_upsert = [schemas.CampaignInsightCreate(**row) for row in df_final.to_dict("records")]
                          │       │                                       │        └ <function DataFrame.to_dict at 0x0000018519BC4B80>
                          │       │                                       └             date_start            date_stop  ...                  stop_time        ad_account_id
                          │       │                                         0  2022-08-21 00:00:00  2022...
                          │       └ <class 'schemas.CampaignInsightCreate'>
                          └ <module 'schemas' from 'D:\\pubsub\\schemas.py'>

  File "C:\Python312\Lib\site-packages\pydantic\main.py", line 211, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     │    │                      │               │                   └ CampaignInsightCreate()
                     │    │                      │               └ {'date_start': Timestamp('2022-08-21 00:00:00'), 'date_stop': Timestamp('2022-09-30 00:00:00'), 'campaign_name': 'Batashoe112...
                     │    │                      └ <method 'validate_python' of 'pydantic_core._pydantic_core.SchemaValidator' objects>
                     │    └ SchemaValidator(title="CampaignInsightCreate", validator=Model(
                     │          ModelValidator {
                     │              revalidate: Never,
                     │              valid...
                     └ CampaignInsightCreate()

pydantic_core._pydantic_core.ValidationError: 1 validation error for CampaignInsightCreate
user_id
  Field required [type=missing, input_value={'date_start': Timestamp(...: 'act_244007880249554'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2025-07-01 17:52:24.993 | INFO     | logging:callHandlers:1762 - Default user not found. Creating one...
2025-07-01 17:52:25.935 | INFO     | logging:callHandlers:1762 - Created new default user with ID: 1
2025-07-01 17:52:25.939 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 17:52:29.496 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 17:52:29.496 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 18:06:09.636 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 18:06:09.658 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 18:06:10.976 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 18:06:10.976 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 20:26:06.427 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 20:26:06.480 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 20:26:11.815 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 20:26:11.815 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 20:28:26.175 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:28:35.820 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:29:19.203 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:29:20.299 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:29:44.154 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 20:29:44.320 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 20:29:46.969 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 20:29:46.970 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 20:29:51.219 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'average cpc'
2025-07-01 20:29:54.206 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 20:29:54.276 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'average cpc'
2025-07-01 20:30:03.498 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:31:11.266 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:31:13.141 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:32:01.567 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:32:03.269 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:32:41.157 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:32:43.611 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:33:23.544 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:33:26.939 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:33:50.418 | INFO     | logging:callHandlers:1762 - Received feedback for turn 6: positive
2025-07-01 20:34:19.891 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:34:25.153 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:35:09.006 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 20:35:13.204 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 20:59:43.378 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 20:59:43.405 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 20:59:45.056 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-01 20:59:45.056 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 21:01:27.151 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:01:29.251 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:01:37.924 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:01:39.716 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:01:52.268 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:01:55.050 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:02:00.698 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:02:02.761 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:02:18.481 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:02:20.572 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:02:45.937 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:02:47.323 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:03:17.338 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:03:19.520 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:03:39.359 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:03:41.491 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:03:50.544 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:03:52.585 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:04:16.604 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:04:19.225 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:04:37.866 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:04:40.199 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:05:13.998 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:05:16.362 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:05:56.044 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:05:59.430 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:06:14.964 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:06:17.684 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:06:35.431 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:06:37.674 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:06:54.997 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:06:57.823 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:07:14.307 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 21:07:17.654 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 21:07:34.689 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.image with prompt: 'Banner Design Specifications:

Headline: "Naturally Delicious, Fun for Everyone!" (Dancing Script font, #FFFACD - Muted Yellow)
Sub-headline (optional, smaller font size): "Handcrafted Chocolates" (Roboto font, #008080 - Deep Teal)
Call to Action: "Discover the Delight!" (Roboto font, #008080 - Deep Teal)
Background Color: #FFF0F5 (Pastel Pink)
Image: A high-quality split image: One side showing close-ups of chocolates in fun shapes with bright, appealing colors; the other side showing a happy child or family enjoying the chocolates. Ensure visual balance between both sides.
Layout: The headline should be prominent at the top, followed by the (optional) sub-headline, then the image, and finally, the call-to-action button placed strategically to encourage clicks.
Remember to maintain a visually balanced and harmonious layout. Ensure enough whitespace to avoid a cluttered look. Make sure the font sizes are appropriate for readability, and the call to action button is clearly visible and easily clickable.'
2025-07-01 21:07:34.707 | INFO     | logging:callHandlers:1762 - 🎨 Mocking image generation for prompt: 'Banner Design Specifications:

Headline: "Naturally Delicious, Fun for Everyone!" (Dancing Script font, #FFFACD - Muted Yellow)
Sub-headline (optional, smaller font size): "Handcrafted Chocolates" (Roboto font, #008080 - Deep Teal)
Call to Action: "Discover the Delight!" (Roboto font, #008080 - Deep Teal)
Background Color: #FFF0F5 (Pastel Pink)
Image: A high-quality split image: One side showing close-ups of chocolates in fun shapes with bright, appealing colors; the other side showing a happy child or family enjoying the chocolates. Ensure visual balance between both sides.
Layout: The headline should be prominent at the top, followed by the (optional) sub-headline, then the image, and finally, the call-to-action button placed strategically to encourage clicks.
Remember to maintain a visually balanced and harmonious layout. Ensure enough whitespace to avoid a cluttered look. Make sure the font sizes are appropriate for readability, and the call to action button is clearly visible and easily clickable.'
2025-07-01 21:08:12.700 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.video with prompt: 'Banner Design Specifications:

Headline: "Naturally Delicious, Fun for Everyone!" (Dancing Script font, #FFFACD - Muted Yellow)
Sub-headline (optional, smaller font size): "Handcrafted Chocolates" (Roboto font, #008080 - Deep Teal)
Call to Action: "Discover the Delight!" (Roboto font, #008080 - Deep Teal)
Background Color: #FFF0F5 (Pastel Pink)
Image: A high-quality split image: One side showing close-ups of chocolates in fun shapes with bright, appealing colors; the other side showing a happy child or family enjoying the chocolates. Ensure visual balance between both sides.
Layout: The headline should be prominent at the top, followed by the (optional) sub-headline, then the image, and finally, the call-to-action button placed strategically to encourage clicks.
Remember to maintain a visually balanced and harmonious layout. Ensure enough whitespace to avoid a cluttered look. Make sure the font sizes are appropriate for readability, and the call to action button is clearly visible and easily clickable.'
2025-07-01 21:08:12.701 | INFO     | logging:callHandlers:1762 - 🎥 Mocking video generation for prompt: 'Banner Design Specifications:

Headline: "Naturally Delicious, Fun for Everyone!" (Dancing Script font, #FFFACD - Muted Yellow)
Sub-headline (optional, smaller font size): "Handcrafted Chocolates" (Roboto font, #008080 - Deep Teal)
Call to Action: "Discover the Delight!" (Roboto font, #008080 - Deep Teal)
Background Color: #FFF0F5 (Pastel Pink)
Image: A high-quality split image: One side showing close-ups of chocolates in fun shapes with bright, appealing colors; the other side showing a happy child or family enjoying the chocolates. Ensure visual balance between both sides.
Layout: The headline should be prominent at the top, followed by the (optional) sub-headline, then the image, and finally, the call-to-action button placed strategically to encourage clicks.
Remember to maintain a visually balanced and harmonious layout. Ensure enough whitespace to avoid a cluttered look. Make sure the font sizes are appropriate for readability, and the call to action button is clearly visible and easily clickable.'
2025-07-01 21:09:07.394 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.video with prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:09:07.395 | INFO     | logging:callHandlers:1762 - 🎥 Mocking video generation for prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:09:11.944 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.image with prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:09:11.945 | INFO     | logging:callHandlers:1762 - 🎨 Mocking image generation for prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:09:14.885 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.video with prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:09:14.887 | INFO     | logging:callHandlers:1762 - 🎥 Mocking video generation for prompt: 'A bsnner ad of new chcolate brand'
2025-07-01 21:24:20.083 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 21:24:21.615 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 21:24:21.616 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 21:25:08.066 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 21:25:09.269 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 21:25:09.270 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 21:25:41.447 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query: 'i have a mango business and i ewat to rn ads in kolkata'
2025-07-01 21:25:44.101 | INFO     | logging:callHandlers:1762 - ✅ Successfully received raw response from LLM: 'That's fantastic!  Kolkata is a vibrant market, perfect for a delicious mango business. To craft the most effective ad campaign for your mangoes in Kolkata, I need a little more information.  What specifically makes your mangoes stand out from the competition? What is your Unique Selling Proposition (USP)?
```json
["My mangoes are organically grown.", "We offer the sweetest mangoes in the region.", "Our mangoes are locally sourced and exceptionally fresh."]
```
'
2025-07-01 21:25:44.102 | INFO     | logging:callHandlers:1762 - ✅ Parsed LLM output: {'tool': 'strategist', 'response': 'That\'s fantastic!  Kolkata is a vibrant market, perfect for a delicious mango business. To craft the most effective ad campaign for your mangoes in Kolkata, I need a little more information.  What specifically makes your mangoes stand out from the competition? What is your Unique Selling Proposition (USP)?\n```json\n["My mangoes are organically grown.", "We offer the sweetest mangoes in the region.", "Our mangoes are locally sourced and exceptionally fresh."]\n```', 'suggestive_replies': []}
2025-07-01 21:25:44.103 | INFO     | logging:callHandlers:1762 - 💬 Strategic intent detected. Continuing conversation.
2025-07-01 21:26:35.670 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query: 'generate a banner of my business thta icread sale by 50%'
2025-07-01 21:26:36.620 | INFO     | logging:callHandlers:1762 - ✅ Successfully received raw response from LLM: '```json
{"tool": "creative", "asset_type": "image", "prompt": "A banner ad for a mango business in Kolkata, designed to increase sales by 50%, featuring high-quality images of mangoes and a compelling call to action."}
```
'
2025-07-01 21:26:36.621 | INFO     | logging:callHandlers:1762 - ✅ Parsed LLM output: {'tool': 'strategist', 'response': '```json\n{"tool": "creative", "asset_type": "image", "prompt": "A banner ad for a mango business in Kolkata, designed to increase sales by 50%, featuring high-quality images of mangoes and a compelling call to action."}\n```', 'suggestive_replies': []}
2025-07-01 21:26:36.622 | INFO     | logging:callHandlers:1762 - 💬 Strategic intent detected. Continuing conversation.
2025-07-01 21:27:33.880 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'average cpc'
2025-07-01 21:27:34.047 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 21:27:34.048 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for data query: 'average cpc'
2025-07-01 21:27:40.614 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from data query LLM.
2025-07-01 21:27:43.623 | INFO     | logging:callHandlers:1762 - Received feedback for turn 27: negative
2025-07-01 21:28:06.014 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 21:28:07.182 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 21:28:07.183 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 21:28:09.019 | INFO     | logging:callHandlers:1762 - 🛠 Starting Facebook Ads data sync for user_id: 1...
2025-07-01 21:28:10.111 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 21:28:10.112 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:08:35.050 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:08:35.075 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:08:37.934 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:08:37.935 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:09:11.659 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:09:14.415 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:09:37.823 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'average cpc'
2025-07-01 23:09:38.061 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 23:09:38.062 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'average cpc'
2025-07-01 23:09:44.857 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:09:57.608 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:09:57.609 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:09:59.176 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:09:59.176 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:11:22.147 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:11:23.575 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:11:29.514 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:11:31.036 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:11:35.465 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:11:36.701 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:11:39.700 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:11:41.256 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:11:48.174 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:11:49.613 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:12:02.719 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:12:06.256 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:16:36.036 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:16:36.072 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:16:37.534 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:16:37.535 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:18:16.193 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:18:16.195 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:18:17.521 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:18:17.522 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:33:49.850 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:33:52.392 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:34:41.682 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:34:43.172 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:35:03.913 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:35:05.353 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:35:28.560 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:35:31.385 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:35:59.241 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:35:59.244 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:36:00.674 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:36:00.674 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:36:13.153 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'whta is my average cpc'
2025-07-01 23:36:13.253 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 23:36:13.265 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is my average cpc'
2025-07-01 23:36:19.154 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:37:23.034 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'whta is the status of my campgain that last run'
2025-07-01 23:37:23.138 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 23:37:23.139 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'whta is the status of my campgain that last run'
2025-07-01 23:37:27.729 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:37:52.553 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'how can i further optimized my last campagin?'
2025-07-01 23:37:52.660 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-01 23:37:52.661 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'how can i further optimized my last campagin?'
2025-07-01 23:37:58.064 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-01 23:58:20.415 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-01 23:58:20.419 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-01 23:58:22.147 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-01 23:58:22.148 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-01 23:58:26.867 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-01 23:58:30.521 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-02 00:03:07.500 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'gove summary of the campagn'
2025-07-02 00:03:07.686 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB to be sent to LLM.
2025-07-02 00:03:07.718 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM for query: 'gove summary of the campagn'
2025-07-02 00:03:14.835 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-02 00:03:48.513 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-02 00:03:51.658 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-02 00:04:17.389 | INFO     | logging:callHandlers:1762 - Received feedback for turn 40: positive
2025-07-02 00:04:28.885 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-02 00:04:28.895 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-02 00:04:30.428 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-02 00:04:30.430 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-02 00:05:56.595 | INFO     | logging:callHandlers:1762 - Received feedback for turn 36: positive
2025-07-02 00:06:14.034 | INFO     | logging:callHandlers:1762 - Received feedback for turn 37: negative
2025-07-02 00:06:25.319 | INFO     | logging:callHandlers:1762 - Received feedback for turn 35: positive
2025-07-02 00:06:51.491 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.image with prompt: 'A banner ad with the chocolate business'
2025-07-02 00:06:51.523 | INFO     | logging:callHandlers:1762 - 🎨 Mocking image generation for prompt: 'A banner ad with the chocolate business'
2025-07-02 00:06:53.056 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.video with prompt: 'A banner ad with the chocolate business'
2025-07-02 00:06:53.060 | INFO     | logging:callHandlers:1762 - 🎥 Mocking video generation for prompt: 'A banner ad with the chocolate business'
2025-07-02 00:08:01.294 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.video with prompt: 'A banner ad with the chocolate business'
2025-07-02 00:08:01.294 | INFO     | logging:callHandlers:1762 - 🎥 Mocking video generation for prompt: 'A banner ad with the chocolate business'
2025-07-02 00:08:21.936 | INFO     | logging:callHandlers:1762 - Received request to generate CreativeAssetType.image with prompt: 'A banner ad with the chocolate business'
2025-07-02 00:08:21.938 | INFO     | logging:callHandlers:1762 - 🎨 Mocking image generation for prompt: 'A banner ad with the chocolate business'
2025-07-02 00:09:00.133 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM with query, history, and learnings.
2025-07-02 00:09:03.815 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 14:42:37.382 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant v4.0.0
2025-07-06 14:42:37.385 | INFO     | logging:callHandlers:1762 - ✅ Enhanced strategist with multi-modal analysis capabilities loaded
2025-07-06 14:42:37.385 | INFO     | logging:callHandlers:1762 - ✅ Forensic analysis engine initialized
2025-07-06 14:42:37.385 | INFO     | logging:callHandlers:1762 - ✅ Creative coaching system ready
2025-07-06 14:42:37.385 | INFO     | logging:callHandlers:1762 - 📡 API endpoints available for comprehensive marketing intelligence
2025-07-06 14:42:56.059 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant v4.0.0
2025-07-06 14:42:56.059 | INFO     | logging:callHandlers:1762 - ✅ Enhanced strategist with multi-modal analysis capabilities loaded
2025-07-06 14:42:56.060 | INFO     | logging:callHandlers:1762 - ✅ Forensic analysis engine initialized
2025-07-06 14:42:56.060 | INFO     | logging:callHandlers:1762 - ✅ Creative coaching system ready
2025-07-06 14:42:56.060 | INFO     | logging:callHandlers:1762 - 📡 API endpoints available for comprehensive marketing intelligence
2025-07-06 14:50:56.202 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 14:50:56.202 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 14:53:57.486 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant v4.0.0
2025-07-06 14:53:57.487 | INFO     | logging:callHandlers:1762 - ✅ Enhanced strategist with multi-modal analysis capabilities loaded
2025-07-06 14:53:57.487 | INFO     | logging:callHandlers:1762 - ✅ Forensic analysis engine initialized
2025-07-06 14:53:57.487 | INFO     | logging:callHandlers:1762 - ✅ Creative coaching system ready
2025-07-06 14:53:57.488 | INFO     | logging:callHandlers:1762 - 📡 API endpoints available for comprehensive marketing intelligence
2025-07-06 15:08:48.746 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant v4.0.0
2025-07-06 15:08:48.747 | INFO     | logging:callHandlers:1762 - ✅ Enhanced strategist with multi-modal analysis capabilities loaded
2025-07-06 15:08:48.748 | INFO     | logging:callHandlers:1762 - ✅ Forensic analysis engine initialized
2025-07-06 15:08:48.748 | INFO     | logging:callHandlers:1762 - ✅ Creative coaching system ready
2025-07-06 15:08:48.749 | INFO     | logging:callHandlers:1762 - 📡 API endpoints available for comprehensive marketing intelligence
2025-07-06 15:13:54.663 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant v4.0.0
2025-07-06 15:13:54.664 | INFO     | logging:callHandlers:1762 - ✅ Enhanced strategist with multi-modal analysis capabilities loaded
2025-07-06 15:13:54.664 | INFO     | logging:callHandlers:1762 - ✅ Forensic analysis engine initialized
2025-07-06 15:13:54.664 | INFO     | logging:callHandlers:1762 - ✅ Creative coaching system ready
2025-07-06 15:13:54.664 | INFO     | logging:callHandlers:1762 - 📡 API endpoints available for comprehensive marketing intelligence
2025-07-06 15:14:26.394 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipment...'
2025-07-06 15:17:34.627 | INFO     | logging:callHandlers:1762 - Received strategist query: 'How can I improve my campaign ROI with a limited budget?...'
2025-07-06 15:17:40.102 | INFO     | logging:callHandlers:1762 - Received strategist query: 'What are the best practices for Facebook Ad creative testing?...'
2025-07-06 15:17:45.133 | INFO     | logging:callHandlers:1762 - Received strategist query: 'How do I identify and fix underperforming campaigns?...'
2025-07-06 15:18:49.347 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 15:18:49.514 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 15:18:49.515 | ERROR    | logging:callHandlers:1762 - ⚠️ Database setup failed: Textual SQL expression 'SELECT 1' should be explicitly declared as text('SELECT 1')
2025-07-06 15:18:49.516 | INFO     | logging:callHandlers:1762 - 📝 App will continue but database features may not work
2025-07-06 15:18:49.516 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 15:20:21.847 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 15:20:21.966 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 15:20:21.966 | ERROR    | logging:callHandlers:1762 - ⚠️ Database setup failed: Textual SQL expression 'SELECT 1' should be explicitly declared as text('SELECT 1')
2025-07-06 15:20:21.967 | INFO     | logging:callHandlers:1762 - 📝 App will continue but database features may not work
2025-07-06 15:20:21.967 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 15:22:28.882 | INFO     | logging:callHandlers:1762 - Default user not found. Creating one...
2025-07-06 15:22:28.906 | INFO     | logging:callHandlers:1762 - Created new default user with ID: 1
2025-07-06 15:22:28.913 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 15:22:39.174 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipmen...'
2025-07-06 15:22:39.329 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 1
2025-07-06 15:22:39.346 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 15:22:40.238 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 15:22:40.240 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 15:22:42.183 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 15:24:34.063 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 15:24:34.292 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 15:24:34.292 | ERROR    | logging:callHandlers:1762 - ⚠️ Database setup failed: Textual SQL expression 'SELECT 1' should be explicitly declared as text('SELECT 1')
2025-07-06 15:24:34.293 | INFO     | logging:callHandlers:1762 - 📝 App will continue but database features may not work
2025-07-06 15:24:34.293 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 15:24:37.403 | INFO     | logging:callHandlers:1762 - Default user not found. Creating one...
2025-07-06 15:24:37.411 | INFO     | logging:callHandlers:1762 - Created new default user with ID: 1
2025-07-06 15:24:37.413 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 15:24:38.950 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 15:24:38.950 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 15:26:21.235 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is the average cpc?'
2025-07-06 15:26:33.378 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is the average cpc?'
2025-07-06 15:26:38.379 | INFO     | logging:callHandlers:1762 - Received strategist query: 'Help me connect my data...'
2025-07-06 15:26:38.391 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 1
2025-07-06 15:26:38.405 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: Help me connect my data...
2025-07-06 15:26:40.336 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 15:54:09.492 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 15:54:09.608 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 15:54:09.609 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 15:54:09.610 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 15:54:18.018 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 15:54:18.021 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 15:54:19.473 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 15:54:19.475 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 15:58:44.403 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 15:58:59.325 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 15:58:59.465 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 15:58:59.467 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 15:58:59.467 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 15:59:17.717 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 15:59:17.723 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 15:59:19.116 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 15:59:19.117 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:00:58.979 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 16:01:43.330 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 16:01:43.432 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 16:01:43.434 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 16:01:43.434 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 16:01:52.390 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 16:01:52.394 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 16:01:54.264 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 16:01:54.265 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:06:49.854 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 16:06:49.865 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 16:06:51.288 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 16:06:51.289 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:06:56.771 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 16:06:56.774 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 16:06:57.916 | WARNING  | logging:callHandlers:1762 - ⚠️ No valid records to upsert after filtering.
2025-07-06 16:06:57.916 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:21:01.101 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 16:29:09.707 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 16:29:09.833 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 16:29:09.835 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 16:29:09.835 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 16:29:15.644 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 16:29:15.646 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 16:29:17.764 | INFO     | logging:callHandlers:1762 - ✅ Raw insights rows: 1
2025-07-06 16:29:17.807 | INFO     | logging:callHandlers:1762 - ✅ Processed final rows: 1
2025-07-06 16:29:17.959 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 16:29:17.969 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:29:39.298 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is the average cpc?'
2025-07-06 16:29:39.439 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB for analysis.
2025-07-06 16:29:39.443 | INFO     | logging:callHandlers:1762 - 🧠 Sending general analysis request to LLM for query: 'what is the average cpc?...'
2025-07-06 16:29:45.795 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 16:29:56.768 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is the average cpc?'
2025-07-06 16:29:56.772 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB for analysis.
2025-07-06 16:29:56.773 | INFO     | logging:callHandlers:1762 - 🧠 Sending general analysis request to LLM for query: 'what is the average cpc?...'
2025-07-06 16:30:02.046 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 16:31:05.149 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipmen...'
2025-07-06 16:31:05.163 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 2
2025-07-06 16:31:05.181 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 16:31:07.719 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 16:43:42.880 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 16:43:42.998 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 16:43:42.999 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 16:43:42.999 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 16:43:54.889 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipment...'
2025-07-06 16:43:54.920 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 3
2025-07-06 16:43:54.950 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 16:43:57.620 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 16:46:49.215 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 16:46:49.318 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 16:46:49.320 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 16:46:49.321 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 16:46:58.241 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 16:46:58.246 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 16:46:59.608 | INFO     | logging:callHandlers:1762 - ✅ Raw insights rows: 1
2025-07-06 16:46:59.676 | INFO     | logging:callHandlers:1762 - ✅ Processed final rows: 1
2025-07-06 16:46:59.703 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 16:46:59.707 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 16:47:04.423 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipment...'
2025-07-06 16:47:04.431 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 4
2025-07-06 16:47:04.452 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 16:47:06.339 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 17:40:22.970 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 17:40:23.256 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 17:40:23.272 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 17:40:23.275 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 17:40:40.744 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 17:40:40.747 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 17:40:41.298 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAOrdFl3ztYBPDLXBN3LwjQG8892PY8C0T83dkZAxZBO3n579Y4AgRzFCR5CXuONZAY3HxlH1g1t2sbjpLuldrMZC6uHgFQFAqRf6OB804PcUhdZBoqlwnXhT8KRclzrZBmIkCbMLVQCYT3dZCH8QFENrDkVdEfQYDBnZCj0xyWjCAiUyV8mZCIofcinBCNVK6SDUmPEfwrf2xA5e16Mi4K8HffUVMQ21w7CiKOBS0AZDZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 17:40:41.299 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAOrdFl3ztYBPDLXBN3LwjQG8892PY8C0T83dkZAxZBO3n579Y4AgRzFCR5CXuONZAY3HxlH1g1t2sbjpLuldrMZC6uHgFQFAqRf6OB804PcUhdZBoqlwnXhT8KRclzrZBmIkCbMLVQCYT3dZCH8QFENrDkVdEfQYDBnZCj0xyWjCAiUyV8mZCIofcinBCNVK6SDUmPEfwrf2xA5e16Mi4K8HffUVMQ21w7CiKOBS0AZDZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001F02333D940>
    └ <WorkerThread(AnyIO worker thread, started 14512)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x000001F0343D1BC0>
    └ <WorkerThread(AnyIO worker thread, started 14512)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ (<sqlalchemy.orm.session.Session object at 0x000001F0343AF560>, 1)
             │       │   └ <function sync_data_task at 0x000001F034365D00>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x000001F0343B0D40>

> File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\main.py", line 89, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x000001F028ABC040>
                   └ <module 'facebook_api' from 'C:\\Users\\SAYAN\\Downloads\\pubsub-20250705T201011Z-1-001\\pubsub\\facebook_api.py'>

  File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\facebook_api.py", line 31, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x000001F028D5F6A0>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAOrdFl3...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAOrdFl3ztYBPDLXBN3LwjQG8892PY8C0T83dkZAxZBO3n579Y4AgRzFCR5CXuONZAY3HxlH1g1t2sbjpLuldrMZC6uHgFQFAqRf6OB804PcUhdZBoqlwnXhT8KRclzrZBmIkCbMLVQCYT3dZCH8QFENrDkVdEfQYDBnZCj0xyWjCAiUyV8mZCIofcinBCNVK6SDUmPEfwrf2xA5e16Mi4K8HffUVMQ21w7CiKOBS0AZDZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 17:42:00.366 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 17:43:28.873 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 17:43:28.999 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 17:43:29.001 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 17:43:29.001 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 17:43:42.770 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 17:43:42.773 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 17:43:44.344 | INFO     | logging:callHandlers:1762 - ✅ Raw insights rows: 1
2025-07-06 17:43:44.426 | INFO     | logging:callHandlers:1762 - ✅ Processed final rows: 1
2025-07-06 17:43:44.508 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 17:43:44.513 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 17:44:42.746 | INFO     | logging:callHandlers:1762 - Received query for synced data: 'what is my average cpc'
2025-07-06 17:44:43.038 | INFO     | logging:callHandlers:1762 - 📊 Fetched 1 records from DB for analysis.
2025-07-06 17:44:43.043 | INFO     | logging:callHandlers:1762 - 🧠 Sending general analysis request to LLM for query: 'what is my average cpc...'
2025-07-06 17:44:49.408 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 17:44:59.837 | INFO     | logging:callHandlers:1762 - Received strategist query: 'Why was the campaign paused prematurely?...'
2025-07-06 17:44:59.871 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 5
2025-07-06 17:44:59.925 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: Why was the campaign paused prematurely?...
2025-07-06 17:45:02.781 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 18:25:31.922 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 18:25:32.282 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 18:25:32.290 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 18:25:32.297 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 18:29:00.622 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 18:29:16.994 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 18:29:17.131 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 18:29:17.133 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 18:29:17.134 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 18:30:24.621 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 18:30:39.972 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 18:30:40.371 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 18:30:40.380 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 18:30:40.389 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 18:36:09.836 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 18:45:50.983 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 18:45:51.127 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 18:45:51.129 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 18:45:51.129 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 18:49:27.217 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 18:49:54.530 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 18:49:54.661 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 18:49:54.662 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 18:49:54.663 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 18:58:48.062 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 19:04:05.658 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 19:04:05.956 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 19:04:05.959 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 19:04:05.961 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 19:07:41.224 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 19:11:52.077 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 19:11:52.246 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 19:11:52.248 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 19:11:52.248 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 19:16:58.050 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 19:20:28.202 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 19:20:28.436 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 19:20:28.476 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 19:20:28.489 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 19:57:36.562 | INFO     | logging:callHandlers:1762 - 👋 Shutting down Campanion AI Assistant
2025-07-06 19:58:03.609 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 19:58:03.797 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 19:58:03.798 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 19:58:03.800 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 21:06:19.824 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 21:06:20.633 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 21:06:20.653 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 21:06:20.657 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 21:06:28.296 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 21:06:28.298 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 21:06:28.742 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPKQSj8jEIO6qeL87fU6zhDUX9wp14oA8X8K5y0I9k6ZAJe5XVpQMsgBC4A33jisZAGpZBHPfohYZBNnxSMpVAo5Cbbbz8n662LUyHSTwtZAFtP8DSnZBA8PaTLKDQmoZAAw0ATKjG21qsNZBlQud1lZBfT4gUDtujxZAfJhzv0AjB7VUfRdBPeZCpwiSkw0bACZB1wpZBL5ThEaNfhM5TmDaGZBlbFW3SoCv3WwQKZCjggZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 21:06:28.743 | ERROR    | logging:callHandlers:1762 - 🔥 Error during background data sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPKQSj8jEIO6qeL87fU6zhDUX9wp14oA8X8K5y0I9k6ZAJe5XVpQMsgBC4A33jisZAGpZBHPfohYZBNnxSMpVAo5Cbbbz8n662LUyHSTwtZAFtP8DSnZBA8PaTLKDQmoZAAw0ATKjG21qsNZBlQud1lZBfT4gUDtujxZAfJhzv0AjB7VUfRdBPeZCpwiSkw0bACZB1wpZBL5ThEaNfhM5TmDaGZBlbFW3SoCv3WwQKZCjggZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000019EC7F7D940>
    └ <WorkerThread(AnyIO worker thread, started 17048)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000019ED8F3B9C0>
    └ <WorkerThread(AnyIO worker thread, started 17048)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ (<sqlalchemy.orm.session.Session object at 0x0000019ED8F466C0>, 1)
             │       │   └ <function sync_data_task at 0x0000019ED8EF3100>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000019ED8F2D700>

> File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\main.py", line 89, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x0000019ECD93A520>
                   └ <module 'facebook_api' from 'C:\\Users\\SAYAN\\Downloads\\pubsub-20250705T201011Z-1-001\\pubsub\\facebook_api.py'>

  File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\facebook_api.py", line 31, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x0000019ECDAF0680>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPKQSj8jEIO6qeL87fU6zhDUX9wp14oA8X8K5y0I9k6ZAJe5XVpQMsgBC4A33jisZAGpZBHPfohYZBNnxSMpVAo5Cbbbz8n662LUyHSTwtZAFtP8DSnZBA8PaTLKDQmoZAAw0ATKjG21qsNZBlQud1lZBfT4gUDtujxZAfJhzv0AjB7VUfRdBPeZCpwiSkw0bACZB1wpZBL5ThEaNfhM5TmDaGZBlbFW3SoCv3WwQKZCjggZD&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 21:06:31.906 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipment...'
2025-07-06 21:06:31.927 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 6
2025-07-06 21:06:31.945 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 21:06:34.836 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 21:10:30.618 | INFO     | logging:callHandlers:1762 - 🚀 Starting Campanion - Intelligent Marketing AI Assistant
2025-07-06 21:10:31.016 | INFO     | logging:callHandlers:1762 - ✅ Database tables created/verified successfully
2025-07-06 21:10:31.018 | INFO     | logging:callHandlers:1762 - ✅ Database connection verified
2025-07-06 21:10:31.022 | INFO     | logging:callHandlers:1762 - ✅ API endpoints ready for marketing intelligence
2025-07-06 21:10:38.752 | INFO     | logging:callHandlers:1762 - Found default user with ID: 1
2025-07-06 21:10:38.756 | INFO     | logging:callHandlers:1762 - 🛠  Starting Facebook Ads data sync for user_id: 1...
2025-07-06 21:10:40.078 | INFO     | logging:callHandlers:1762 - ✅ Raw insights rows: 1
2025-07-06 21:10:40.130 | INFO     | logging:callHandlers:1762 - ✅ Processed final rows: 1
2025-07-06 21:10:40.158 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 21:10:40.158 | INFO     | logging:callHandlers:1762 - ✅ Data sync complete for user_id: 1.
2025-07-06 21:10:48.048 | INFO     | logging:callHandlers:1762 - Received strategist query: 'I run an e-commerce store selling fitness equipment...'
2025-07-06 21:10:48.058 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 7
2025-07-06 21:10:48.072 | INFO     | logging:callHandlers:1762 - 🧠 Sending request to LLM in conversation mode with query: I run an e-commerce store selling fitness equipment...
2025-07-06 21:10:50.772 | INFO     | logging:callHandlers:1762 - ✅ Successfully received response from LLM.
2025-07-06 21:53:16.103 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 21:53:17.413 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 21:53:17.414 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 21:54:08.294 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what is the average cpc?'
2025-07-06 21:54:08.422 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 21:54:08.425 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what is the average cpc?'
2025-07-06 21:54:12.121 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 21:54:33.516 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 21:54:34.861 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 21:54:34.861 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 21:54:43.346 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 21:54:44.462 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 21:54:44.462 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 21:55:04.129 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'i want to run add  fro my diary business in gretaer kolkata' for conversation ID: None
2025-07-06 21:55:04.140 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 8
2025-07-06 21:55:04.157 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 21:55:04.158 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 21:55:06.902 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 21:55:06.911 | INFO     | logging:callHandlers:1762 - 💬 Added turn 14 to conversation 8 - Query length: 59, Response length: 638
2025-07-06 21:55:24.712 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'How do I test different ad variations?' for conversation ID: 8
2025-07-06 21:55:24.716 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 21:55:24.717 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 21:55:29.634 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 21:55:29.644 | INFO     | logging:callHandlers:1762 - 💬 Added turn 15 to conversation 8 - Query length: 38, Response length: 3206
2025-07-06 21:55:53.387 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'How do I test different ad variations?' for conversation ID: 8
2025-07-06 21:55:53.394 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 21:55:53.397 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 21:55:58.861 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 21:55:58.869 | INFO     | logging:callHandlers:1762 - 💬 Added turn 16 to conversation 8 - Query length: 38, Response length: 3580
2025-07-06 21:56:29.576 | INFO     | logging:callHandlers:1762 - Received strategist query in conversation mode: 'what is the best add platform for it?' for conversation ID: 8
2025-07-06 21:56:29.583 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 21:56:33.557 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 21:56:33.561 | INFO     | logging:callHandlers:1762 - 💬 Added turn 17 to conversation 8 - Query length: 37, Response length: 2740
2025-07-06 21:57:23.448 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 21:57:24.806 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 21:57:24.806 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 21:57:50.342 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what iwhihch region my camgain in run'
2025-07-06 21:57:50.347 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 21:57:50.349 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what iwhihch region my camgain in run'
2025-07-06 21:57:51.363 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 22:00:17.379 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'i wnat to do a food business basically based on biriyani in Kolkata.what should be my strategy to gain the makret .' for conversation ID: None
2025-07-06 22:00:17.389 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 9
2025-07-06 22:00:17.406 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:00:19.384 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:00:19.389 | INFO     | logging:callHandlers:1762 - 💬 Added turn 18 to conversation 9 - Query length: 115, Response length: 937
2025-07-06 22:01:02.550 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'customer age 18 to 35' for conversation ID: 9
2025-07-06 22:01:02.558 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:01:04.717 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:01:04.721 | INFO     | logging:callHandlers:1762 - 💬 Added turn 19 to conversation 9 - Query length: 21, Response length: 1127
2025-07-06 22:01:46.608 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'mutton and busget freindly' for conversation ID: 9
2025-07-06 22:01:46.615 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:01:49.369 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:01:49.381 | INFO     | logging:callHandlers:1762 - 💬 Added turn 20 to conversation 9 - Query length: 26, Response length: 1567
2025-07-06 22:02:49.895 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'gove more suggetsions' for conversation ID: 9
2025-07-06 22:02:49.906 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:02:54.340 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:02:54.347 | INFO     | logging:callHandlers:1762 - 💬 Added turn 21 to conversation 9 - Query length: 21, Response length: 2875
2025-07-06 22:03:34.736 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'give some suggetsions of the USP' for conversation ID: 9
2025-07-06 22:03:34.746 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:03:39.433 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:03:39.437 | INFO     | logging:callHandlers:1762 - 💬 Added turn 22 to conversation 9 - Query length: 32, Response length: 2716
2025-07-06 22:04:03.151 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'give me the best one USP' for conversation ID: 9
2025-07-06 22:04:03.175 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:04:06.381 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:04:06.385 | INFO     | logging:callHandlers:1762 - 💬 Added turn 23 to conversation 9 - Query length: 24, Response length: 1947
2025-07-06 22:04:50.057 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'Give more two poteail optiions i still dont like it' for conversation ID: 9
2025-07-06 22:04:50.068 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:04:53.916 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:04:53.925 | INFO     | logging:callHandlers:1762 - 💬 Added turn 24 to conversation 9 - Query length: 51, Response length: 2315
2025-07-06 22:05:31.565 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'take option 4' for conversation ID: 9
2025-07-06 22:05:31.574 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:05:35.023 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:05:35.032 | INFO     | logging:callHandlers:1762 - 💬 Added turn 25 to conversation 9 - Query length: 13, Response length: 1914
2025-07-06 22:06:48.860 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'What new platforms should I consider?' for conversation ID: 9
2025-07-06 22:06:48.867 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:06:54.006 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:06:54.013 | INFO     | logging:callHandlers:1762 - 💬 Added turn 26 to conversation 9 - Query length: 37, Response length: 3257
2025-07-06 22:08:10.192 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'now generte a report of the startegy' for conversation ID: 9
2025-07-06 22:08:10.203 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:08:15.938 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:08:15.946 | INFO     | logging:callHandlers:1762 - 💬 Added turn 27 to conversation 9 - Query length: 36, Response length: 3881
2025-07-06 22:08:57.359 | INFO     | logging:callHandlers:1762 - Received strategist query in report mode: 'give the downaliable fimat' for conversation ID: 9
2025-07-06 22:08:57.366 | INFO     | logging:callHandlers:1762 - 🧠 Sending report mode request to LLM with query and learnings.
2025-07-06 22:09:04.437 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:09:04.445 | INFO     | logging:callHandlers:1762 - 💬 Added turn 28 to conversation 9 - Query length: 26, Response length: 4731
2025-07-06 22:11:57.859 | INFO     | logging:callHandlers:1762 - Received strategist query in conversation mode: 'What's my audience overlap situation?' for conversation ID: 9
2025-07-06 22:11:57.869 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:12:03.363 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:12:03.369 | INFO     | logging:callHandlers:1762 - 💬 Added turn 29 to conversation 9 - Query length: 37, Response length: 3582
2025-07-06 22:12:12.328 | INFO     | logging:callHandlers:1762 - Received strategist query in conversation mode: 'Generate a weekly performance report' for conversation ID: 9
2025-07-06 22:12:12.336 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:12:16.700 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:12:16.709 | INFO     | logging:callHandlers:1762 - 💬 Added turn 30 to conversation 9 - Query length: 36, Response length: 2408
2025-07-06 22:48:59.086 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 22:48:59.474 | ERROR    | logging:callHandlers:1762 - HTTP request to fetch campaigns failed: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPPx0JNmCP7e1n9CozXRGZCGZCZAVp0QoaJvQZBy6gNrDqa9bEj17i7XkzCxF4ZAddbq2tEOa4TZBEy1L3Vc8obyKGDbDZCZCnw34aZCmZBTSZBJkLACDmNghyDUrw47j5wLuZBOPZChg44UWYkXBZA0bKcmcJEyWQzl1RztT5ZCPUo1YjGaTHIC2ASZCVxjByLnqoLZApWnzI3qAHhZChTuVTfVK53nLUH97jK6DIXTmTfLwZDZ&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 22:48:59.477 | ERROR    | logging:callHandlers:1762 - 🔥 Error during enhanced background data sync task: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPPx0JNmCP7e1n9CozXRGZCGZCZAVp0QoaJvQZBy6gNrDqa9bEj17i7XkzCxF4ZAddbq2tEOa4TZBEy1L3Vc8obyKGDbDZCZCnw34aZCmZBTSZBJkLACDmNghyDUrw47j5wLuZBOPZChg44UWYkXBZA0bKcmcJEyWQzl1RztT5ZCPUo1YjGaTHIC2ASZCVxjByLnqoLZApWnzI3qAHhZChTuVTfVK53nLUH97jK6DIXTmTfLwZDZ&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
Traceback (most recent call last):

  File "C:\Python312\Lib\threading.py", line 1032, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000010AC1B4D940>
    └ <WorkerThread(AnyIO worker thread, started 18360)>
  File "C:\Python312\Lib\threading.py", line 1075, in _bootstrap_inner
    self.run()
    │    └ <function WorkerThread.run at 0x0000010AD2B48400>
    └ <WorkerThread(AnyIO worker thread, started 18360)>
  File "C:\Python312\Lib\site-packages\anyio\_backends\_asyncio.py", line 859, in run
    result = context.run(func, *args)
             │       │   │      └ (<sqlalchemy.orm.session.Session object at 0x0000010AD2B0A1B0>,)
             │       │   └ <function sync_data_task at 0x0000010AD2ACAD40>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x0000010AD2B0DB80>

> File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\main.py", line 60, in sync_data_task
    df_campaigns = facebook_api.fetch_campaigns()
                   │            └ <function fetch_campaigns at 0x0000010AC7530540>
                   └ <module 'facebook_api' from 'C:\\Users\\SAYAN\\Downloads\\pubsub-20250705T201011Z-1-001\\pubsub\\facebook_api.py'>

  File "C:\Users\SAYAN\Downloads\pubsub-20250705T201011Z-1-001\pubsub\facebook_api.py", line 32, in fetch_campaigns
    response.raise_for_status()
    │        └ <function Response.raise_for_status at 0x0000010AC76C6340>
    └ <Response [400]>

  File "C:\Python312\Lib\site-packages\requests\models.py", line 1024, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
          │         │                        └ <Response [400]>
          │         └ '400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ...
          └ <class 'requests.exceptions.HTTPError'>

requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://graph.facebook.com/v22.0/act_244007880249554/campaigns?access_token=EAAPLaekJ054BPPx0JNmCP7e1n9CozXRGZCGZCZAVp0QoaJvQZBy6gNrDqa9bEj17i7XkzCxF4ZAddbq2tEOa4TZBEy1L3Vc8obyKGDbDZCZCnw34aZCmZBTSZBJkLACDmNghyDUrw47j5wLuZBOPZChg44UWYkXBZA0bKcmcJEyWQzl1RztT5ZCPUo1YjGaTHIC2ASZCVxjByLnqoLZApWnzI3qAHhZChTuVTfVK53nLUH97jK6DIXTmTfLwZDZ&fields=id%2Cname%2Cstatus%2Ceffective_status%2Cstart_time%2Cstop_time&limit=500
2025-07-06 22:51:06.422 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 22:51:08.324 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 22:51:08.366 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 22:51:50.844 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'I want to run my dary buniess in ad platfrom in greater  kolkata' for conversation ID: None
2025-07-06 22:51:50.867 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 10
2025-07-06 22:51:50.885 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 22:51:50.899 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:51:53.654 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:51:53.668 | INFO     | logging:callHandlers:1762 - 💬 Added turn 31 to conversation 10 - Query length: 64, Response length: 599
2025-07-06 22:51:57.194 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 22:51:58.365 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 22:51:58.365 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 22:53:06.968 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 22:53:08.326 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 22:53:08.327 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 22:53:23.548 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what is the total budget?'
2025-07-06 22:53:23.756 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 22:53:23.760 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what is the total budget?'
2025-07-06 22:53:26.861 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 22:55:20.268 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'How can I reach my target market?' for conversation ID: None
2025-07-06 22:55:20.274 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 11
2025-07-06 22:55:20.281 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 22:55:20.282 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:55:21.704 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:55:21.708 | INFO     | logging:callHandlers:1762 - 💬 Added turn 32 to conversation 11 - Query length: 33, Response length: 564
2025-07-06 22:56:13.739 | INFO     | logging:callHandlers:1762 - Received standard analysis query: '“Can you tell me the CTR for my Facebook ads this week?”'
2025-07-06 22:56:13.750 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 22:56:13.752 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: '“Can you tell me the CTR for my Facebook ads this week?”'
2025-07-06 22:56:15.008 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 22:56:36.846 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 22:56:38.019 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 22:56:38.021 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 22:57:46.954 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'I HAVE A FOOD BUNIESSS OF BIRIYANI IN GREATER KOLKATA' for conversation ID: 11
2025-07-06 22:57:46.965 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 22:57:46.966 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:57:48.014 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:57:48.017 | INFO     | logging:callHandlers:1762 - 💬 Added turn 33 to conversation 11 - Query length: 53, Response length: 357
2025-07-06 22:59:12.410 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'What new platforms should I consider?' for conversation ID: 11
2025-07-06 22:59:12.417 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 22:59:12.418 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 22:59:13.771 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 22:59:13.775 | INFO     | logging:callHandlers:1762 - 💬 Added turn 34 to conversation 11 - Query length: 37, Response length: 626
2025-07-06 23:01:33.818 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'What's my audience overlap situation?' for conversation ID: 11
2025-07-06 23:01:33.826 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:01:33.830 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:01:35.358 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:01:35.363 | INFO     | logging:callHandlers:1762 - 💬 Added turn 35 to conversation 11 - Query length: 37, Response length: 734
2025-07-06 23:07:09.038 | INFO     | logging:callHandlers:1762 - Received strategist query in alert mode: 'MAKE  A BANNER OF MY BUINESS MODEL A  FOOD BUSINESS OF BIRIYANI IN GRETATER KOLKATA' for conversation ID: None
2025-07-06 23:07:09.047 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 12
2025-07-06 23:07:09.059 | INFO     | logging:callHandlers:1762 - 🧠 Sending alert mode request to LLM with query and learnings.
2025-07-06 23:07:15.420 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:07:15.450 | INFO     | logging:callHandlers:1762 - 💬 Added turn 36 to conversation 12 - Query length: 83, Response length: 2777
2025-07-06 23:40:50.202 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 23:40:51.991 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 23:40:51.992 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 23:41:33.733 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 23:41:35.218 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 23:41:35.219 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 23:42:26.110 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 23:42:27.370 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 23:42:27.373 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 23:42:42.379 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'What id  the total budget of my campgain?'
2025-07-06 23:42:42.412 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 23:42:42.419 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'What id  the total budget of my campgain?'
2025-07-06 23:42:44.735 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 23:43:55.603 | INFO     | logging:callHandlers:1762 - 🛠 Starting enhanced Facebook Ads data sync...
2025-07-06 23:43:56.905 | INFO     | logging:callHandlers:1762 - ✅ Successfully upserted 1 records.
2025-07-06 23:43:56.906 | INFO     | logging:callHandlers:1762 - ✅ Enhanced data sync complete with optimization analysis.
2025-07-06 23:44:22.038 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what is my campgain id?'
2025-07-06 23:44:22.040 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 23:44:22.041 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what is my campgain id?'
2025-07-06 23:44:23.047 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 23:44:59.082 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what is my last campgain id?'
2025-07-06 23:44:59.087 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 23:44:59.088 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what is my last campgain id?'
2025-07-06 23:45:00.767 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 23:45:12.360 | INFO     | logging:callHandlers:1762 - Received standard analysis query: 'what is my current campgain id?'
2025-07-06 23:45:12.364 | INFO     | logging:callHandlers:1762 - 📊 Performing standard analysis on 1 records.
2025-07-06 23:45:12.368 | INFO     | logging:callHandlers:1762 - 🧠 Performing standard analysis for query: 'what is my current campgain id?'
2025-07-06 23:45:14.080 | INFO     | logging:callHandlers:1762 - ✅ Successfully completed enhanced data analysis.
2025-07-06 23:46:39.608 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'I have a dress boutique where i am selling many premium dresses for male and females for all purpose occassion.Now tell me how i Shoud start my campagin,How shoud i Start,Can you suggest?' for conversation ID: None
2025-07-06 23:46:39.626 | INFO     | logging:callHandlers:1762 - 📝 Created new conversation with ID: 13
2025-07-06 23:46:39.648 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:46:39.666 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:46:40.782 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:46:40.792 | INFO     | logging:callHandlers:1762 - 💬 Added turn 37 to conversation 13 - Query length: 187, Response length: 300
2025-07-06 23:47:14.224 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'Snikta's Boutique' for conversation ID: 13
2025-07-06 23:47:14.627 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:47:14.628 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:47:16.077 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:47:16.083 | INFO     | logging:callHandlers:1762 - 💬 Added turn 38 to conversation 13 - Query length: 17, Response length: 368
2025-07-06 23:47:47.442 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'wedding attire and casual wear' for conversation ID: 13
2025-07-06 23:47:47.455 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:47:47.478 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:47:48.666 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:47:48.670 | INFO     | logging:callHandlers:1762 - 💬 Added turn 39 to conversation 13 - Query length: 30, Response length: 473
2025-07-06 23:48:38.434 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'Age 22-34 for both male and female and loaxtin is west bengal and oddisha and income is moderate' for conversation ID: 13
2025-07-06 23:48:38.444 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:48:38.445 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:48:39.533 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:48:39.541 | INFO     | logging:callHandlers:1762 - 💬 Added turn 40 to conversation 13 - Query length: 96, Response length: 396
2025-07-06 23:49:12.982 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'mostrly instagram' for conversation ID: 13
2025-07-06 23:49:12.988 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:49:12.991 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:49:14.355 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:49:14.362 | INFO     | logging:callHandlers:1762 - 💬 Added turn 41 to conversation 13 - Query length: 17, Response length: 695
2025-07-06 23:49:59.529 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'generating leads and as well as brand awareness' for conversation ID: 13
2025-07-06 23:49:59.536 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:49:59.537 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:50:00.987 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:50:00.995 | INFO     | logging:callHandlers:1762 - 💬 Added turn 42 to conversation 13 - Query length: 47, Response length: 726
2025-07-06 23:50:53.919 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: '50k' for conversation ID: 13
2025-07-06 23:50:53.928 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:50:53.931 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:50:55.639 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:50:55.648 | INFO     | logging:callHandlers:1762 - 💬 Added turn 43 to conversation 13 - Query length: 3, Response length: 860
2025-07-06 23:52:20.498 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'can you set some rules keppig in my whatever we discuss till now so thta i can folow those thung pointwise when i set my campagin at meta' for conversation ID: 13
2025-07-06 23:52:20.507 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:52:20.511 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:52:25.015 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:52:25.037 | INFO     | logging:callHandlers:1762 - 💬 Added turn 44 to conversation 13 - Query length: 137, Response length: 2976
2025-07-06 23:52:48.810 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'guve me only pointr in a singke line all this' for conversation ID: 13
2025-07-06 23:52:48.819 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:52:48.830 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:52:49.923 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:52:49.929 | INFO     | logging:callHandlers:1762 - 💬 Added turn 45 to conversation 13 - Query length: 45, Response length: 311
2025-07-06 23:53:17.054 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'gve me pointwise like 1 2 3 ...' for conversation ID: 13
2025-07-06 23:53:17.063 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:53:17.065 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:53:19.166 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:53:19.205 | INFO     | logging:callHandlers:1762 - 💬 Added turn 46 to conversation 13 - Query length: 31, Response length: 1073
2025-07-06 23:53:54.348 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'give me steo by steo like 1 2 3 and so on' for conversation ID: 13
2025-07-06 23:53:54.357 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:53:54.358 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:53:57.565 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:53:57.575 | INFO     | logging:callHandlers:1762 - 💬 Added turn 47 to conversation 13 - Query length: 41, Response length: 1983
2025-07-06 23:54:51.798 | INFO     | logging:callHandlers:1762 - Received strategist query in auto mode: 'give me rulebased suggetsion and pushed this inti my meta' for conversation ID: 13
2025-07-06 23:54:51.810 | INFO     | logging:callHandlers:1762 - 🎯 Auto-detected mode: conversation
2025-07-06 23:54:51.814 | INFO     | logging:callHandlers:1762 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-06 23:54:56.359 | INFO     | logging:callHandlers:1762 - ✅ Successfully received enhanced response from LLM.
2025-07-06 23:54:56.364 | INFO     | logging:callHandlers:1762 - 💬 Added turn 48 to conversation 13 - Query length: 57, Response length: 2869
2025-07-08 15:54:24.757 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 517907
2025-07-08 15:54:54.139 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'need help' for conversation ID: 338193
2025-07-08 16:00:13.249 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 975832
2025-07-08 16:28:32.939 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 359123
2025-07-08 16:48:21.736 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 265049
2025-07-08 16:48:27.778 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 1
2025-07-08 16:48:28.638 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 16:48:28.640 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000017BDB6D7380>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000017BDB3DD4E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000017BDB3DCA40>
    └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000017BDB6ACAD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
    │    └ <function subprocess_started at 0x0000017BDDA60E00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=396, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000017BDDB99810>>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=396, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000017BDDA3BD80>
           │       │   └ <uvicorn.server.Server object at 0x0000017BDDB99810>
           │       └ <function run at 0x0000017BDD266F20>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000017BDDBA4F20>
           │      └ <function Runner.run at 0x0000017BDD347420>
           └ <asyncio.runners.Runner object at 0x0000017BDDB98F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py:81> ...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000017BDD344EA0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000017BDDB98F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000017BDD344E00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000017BDD346C00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000017BDD268360>
    └ <Handle Task.task_wakeup(<Future finis...017BF1C5C250>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...017BF1C5C250>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...017BF1C5C250>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...017BF1C5C250>>)>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017BDDBAA250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000017BF1B7E390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017BDDBAA250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017BF1BE5290>
          └ <fastapi.applications.FastAPI object at 0x0000017BF1B7E390>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017BF1BE2660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017BF1BE5290>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '39', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017BF1BE2660>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000017BE064ACA0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017BDDD6A150>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1BE27A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000017BF163EC50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017BDDD6A150>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1BE27A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000017BF1BD9490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000017BF163EC50>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1BE27A0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000017BDEB34B80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1BE27A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000017BF1BE11C0>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000017BF1C06DD0>
                     └ <function get_request_handler.<locals>.app at 0x0000017BF1BE1080>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000017BDEAFEE80>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000017BF1C5C250>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x0000017BF1BE0FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000017BF1BE7410>

  File "D:\CampFront\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000017BF1B82C00>
                             └ <module 'strategist_llm_service' from 'D:\\CampFront\\chatty\\strategist_llm_service.py'>

> File "D:\CampFront\chatty\strategist_llm_service.py", line 132, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFront\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 16:48:29.979 | INFO     | logging:callHandlers:1706 - 💬 Added turn 1 to conversation 1 - Query length: 2, Response length: 118
2025-07-08 16:48:44.781 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'what are the campaigns' for conversation ID: 265049
2025-07-08 16:48:46.467 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 2
2025-07-08 16:48:47.308 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 16:48:47.308 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000017BDB6D7380>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000017BDB3DD4E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000017BDB3DCA40>
    └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000017BDB6ACAD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
    │    └ <function subprocess_started at 0x0000017BDDA60E00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20308 started>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=396, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000017BDDB99810>>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=396, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000017BDDA3BD80>
           │       │   └ <uvicorn.server.Server object at 0x0000017BDDB99810>
           │       └ <function run at 0x0000017BDD266F20>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000017BDDBA4F20>
           │      └ <function Runner.run at 0x0000017BDD347420>
           └ <asyncio.runners.Runner object at 0x0000017BDDB98F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py:81> ...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000017BDD344EA0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000017BDDB98F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000017BDD344E00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000017BDD346C00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000017BDD268360>
    └ <Handle Task.task_wakeup(<Future finis...017BF1BECD50>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...017BF1BECD50>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...017BF1BECD50>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...017BF1BECD50>>)>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017BDDBAA250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000017BF1B7E390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000017BDDBAA250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017BF1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017BF1BE5290>
          └ <fastapi.applications.FastAPI object at 0x0000017BF1B7E390>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017BF1C77920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000017BF1BE5290>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '59', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000017BF1C77920>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000017BE064ACA0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017BDDD6A150>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000017BF1BEFC90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1C56F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000017BF163EC50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000017BDDD6A150>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1C56F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000017BF1BD9490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000017BF163EC50>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1C56F20>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000017BDEB34B80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000017BF1C56F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000017...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000017BF1BE11C0>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000017BF1BE55D0>
                     └ <function get_request_handler.<locals>.app at 0x0000017BF1BE1080>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000017BDEAFEE80>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000017BF1BECD50>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x0000017BF1BE0FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000017BF1BE7410>

  File "D:\CampFront\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000017BF1B82C00>
                             └ <module 'strategist_llm_service' from 'D:\\CampFront\\chatty\\strategist_llm_service.py'>

> File "D:\CampFront\chatty\strategist_llm_service.py", line 132, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFront\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 16:48:48.453 | INFO     | logging:callHandlers:1706 - 💬 Added turn 2 to conversation 2 - Query length: 22, Response length: 118
2025-07-08 16:54:01.215 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 410750
2025-07-08 16:54:07.147 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 3
2025-07-08 16:54:07.997 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 16:54:07.997 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x0000023AEC787380>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x0000023AEC48D4E0>
           └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000023AEC48CA40>
    └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000023AEC75CAD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
    │    └ <function subprocess_started at 0x0000023AEEB30E00>
    └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000023AEEC59810>>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000023AEEB0BD80>
           │       │   └ <uvicorn.server.Server object at 0x0000023AEEC59810>
           │       └ <function run at 0x0000023AEE2F6F20>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000023AEEC64F20>
           │      └ <function Runner.run at 0x0000023AEE457420>
           └ <asyncio.runners.Runner object at 0x0000023AEEC58F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py:81> ...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000023AEE454EA0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000023AEEC58F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000023AEE454E00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000023AEE456C00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000023AEE2F8360>
    └ <Handle Task.task_wakeup(<Future finis...023A82C7C210>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...023A82C7C210>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...023A82C7C210>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...023A82C7C210>>)>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000023AEEC6A250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000023A81F34D90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000023AEEC6A250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000023A82C463D0>
          └ <fastapi.applications.FastAPI object at 0x0000023A81F34D90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000023A82C200E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000023A82C463D0>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '39', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000023A82C200E0>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000023AF168ACA0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A82C33AD0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82C22700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000023A80225350>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A82C33AD0>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82C22700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000023A82C193D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000023A80225350>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82C22700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000023AEFB74B80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82C22700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000023A82C211C0>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000023A82C47450>
                     └ <function get_request_handler.<locals>.app at 0x0000023A82C21080>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000023AEFB3EE80>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000023A82C7C210>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x0000023A82C20FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000023A82C272D0>

  File "D:\CampFront\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000023A82BC2CA0>
                             └ <module 'strategist_llm_service' from 'D:\\CampFront\\chatty\\strategist_llm_service.py'>

> File "D:\CampFront\chatty\strategist_llm_service.py", line 132, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFront\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 16:54:09.197 | INFO     | logging:callHandlers:1706 - 💬 Added turn 3 to conversation 3 - Query length: 2, Response length: 118
2025-07-08 16:54:41.870 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'tell me about you' for conversation ID: 410750
2025-07-08 16:54:43.535 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 4
2025-07-08 16:54:44.370 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 16:54:44.370 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x0000023AEC787380>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x0000023AEC48D4E0>
           └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000023AEC48CA40>
    └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000023AEC75CAD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
    │    └ <function subprocess_started at 0x0000023AEEB30E00>
    └ <SpawnProcess name='SpawnProcess-2' parent=20308 started>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000023AEEC59810>>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000023AEEB0BD80>
           │       │   └ <uvicorn.server.Server object at 0x0000023AEEC59810>
           │       └ <function run at 0x0000023AEE2F6F20>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000023AEEC64F20>
           │      └ <function Runner.run at 0x0000023AEE457420>
           └ <asyncio.runners.Runner object at 0x0000023AEEC58F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\server.py:81> ...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000023AEE454EA0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000023AEEC58F90>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000023AEE454E00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000023AEE456C00>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000023AEE2F8360>
    └ <Handle Task.task_wakeup(<Future finis...023A82C1BF50>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...023A82C1BF50>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...023A82C1BF50>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...023A82C1BF50>>)>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000023AEEC6A250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000023A81F34D90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000023AEEC6A250>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023A82...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000023A82C463D0>
          └ <fastapi.applications.FastAPI object at 0x0000023A81F34D90>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000023A82C96E80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000023A82C463D0>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '54', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000023A82C96E80>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x0000023AF168ACA0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A82C33AD0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A82C33990>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82CE7600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000023A80225350>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A82C33AD0>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82CE7600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000023A82C193D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000023A80225350>
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82CE7600>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000023AEFB74B80>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000023A82CE7600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000023A82C211C0>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFront\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000023A82E5FB90>
                     └ <function get_request_handler.<locals>.app at 0x0000023A82C21080>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000023AEFB3EE80>
  File "D:\CampFront\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x0000023A82C1BF50>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x0000023A82C20FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000023A82C272D0>

  File "D:\CampFront\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x0000023A82BC2CA0>
                             └ <module 'strategist_llm_service' from 'D:\\CampFront\\chatty\\strategist_llm_service.py'>

> File "D:\CampFront\chatty\strategist_llm_service.py", line 132, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFront\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 16:54:45.495 | INFO     | logging:callHandlers:1706 - 💬 Added turn 4 to conversation 4 - Query length: 17, Response length: 118
2025-07-08 17:19:30.558 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 603178
2025-07-08 17:19:36.406 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 5
2025-07-08 17:19:37.229 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 17:19:37.229 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 17:19:52.764 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 17:19:53.849 | INFO     | logging:callHandlers:1706 - 💬 Added turn 5 to conversation 5 - Query length: 2, Response length: 574
2025-07-08 17:20:09.204 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'tell me about campaigns' for conversation ID: 603178
2025-07-08 17:20:10.825 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 6
2025-07-08 17:20:11.641 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 17:20:11.641 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 17:20:28.739 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 17:20:29.826 | INFO     | logging:callHandlers:1706 - 💬 Added turn 6 to conversation 6 - Query length: 23, Response length: 459
2025-07-08 17:20:53.769 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'What are my campaign goals?' for conversation ID: 603178
2025-07-08 17:20:55.388 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 7
2025-07-08 17:20:56.205 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 17:20:56.205 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 17:21:49.772 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 17:21:50.863 | INFO     | logging:callHandlers:1706 - 💬 Added turn 7 to conversation 7 - Query length: 27, Response length: 544
2025-07-08 17:22:37.330 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'My main goal is to increase brand awareness' for conversation ID: 603178
2025-07-08 17:22:38.955 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 8
2025-07-08 17:22:39.774 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 17:22:39.774 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 17:23:48.595 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 17:23:49.695 | INFO     | logging:callHandlers:1706 - 💬 Added turn 8 to conversation 8 - Query length: 43, Response length: 416
2025-07-08 17:24:10.504 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'tell me about Campaxe' for conversation ID: 603178
2025-07-08 17:24:12.132 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 9
2025-07-08 17:24:12.946 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 17:24:12.946 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 17:24:27.723 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 17:24:28.810 | INFO     | logging:callHandlers:1706 - 💬 Added turn 9 to conversation 9 - Query length: 21, Response length: 752
2025-07-08 18:08:58.857 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 299810
2025-07-08 18:09:00.708 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 10
2025-07-08 18:09:01.527 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 18:09:01.556 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 18:09:06.723 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 18:09:07.804 | INFO     | logging:callHandlers:1706 - 💬 Added turn 10 to conversation 10 - Query length: 2, Response length: 578
2025-07-08 18:09:23.608 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'tell me about campaxe' for conversation ID: 299810
2025-07-08 18:09:25.227 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 11
2025-07-08 18:09:26.038 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 18:09:26.039 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 18:09:27.622 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 18:09:28.701 | INFO     | logging:callHandlers:1706 - 💬 Added turn 11 to conversation 11 - Query length: 21, Response length: 409
2025-07-08 18:28:29.523 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 540070
2025-07-08 18:28:31.211 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 12
2025-07-08 18:28:32.095 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 18:28:32.107 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 18:28:38.488 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 18:28:39.577 | INFO     | logging:callHandlers:1706 - 💬 Added turn 12 to conversation 12 - Query length: 2, Response length: 552
2025-07-08 20:09:10.357 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 252764
2025-07-08 20:09:16.331 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 13
2025-07-08 20:09:17.178 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 20:09:17.178 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000280B30474C0>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000280B2D4D620>
           └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000280B2D4CB80>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000280B3020AD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    └ <function subprocess_started at 0x00000280B5440FE0>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000280B5569690>>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000280B5440040>
           │       │   └ <uvicorn.server.Server object at 0x00000280B5569690>
           │       └ <function run at 0x00000280B4BB7060>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000280B5574F20>
           │      └ <function Runner.run at 0x00000280B4D67560>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000280B4D64FE0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000280B4D64F40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000280B4D66D40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000280B4BB84A0>
    └ <Handle Task.task_wakeup(<Future finis...0280C94FD6D0>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...0280C94FD6D0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...0280C94FD6D0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...0280C94FD6D0>>)>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
          └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '39', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9760>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000280B7F4D9E0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000280C94E5050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000280B645F240>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000280C94F8360>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000280C950E890>
                     └ <function get_request_handler.<locals>.app at 0x00000280C94F8220>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000280B645D580>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x00000280C94FD6D0>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x00000280C94F8180>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000280C94F2F50>

  File "D:\CampFrontClean\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x00000280C9491620>
                             └ <module 'strategist_llm_service' from 'D:\\CampFrontClean\\chatty\\strategist_llm_service.py'>

> File "D:\CampFrontClean\chatty\strategist_llm_service.py", line 159, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFrontClean\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 20:09:18.425 | INFO     | logging:callHandlers:1706 - 💬 Added turn 13 to conversation 13 - Query length: 2, Response length: 118
2025-07-08 20:09:34.314 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'what are campaigns' for conversation ID: 252764
2025-07-08 20:09:35.980 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 14
2025-07-08 20:09:36.814 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 20:09:36.814 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000280B30474C0>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000280B2D4D620>
           └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000280B2D4CB80>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000280B3020AD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    └ <function subprocess_started at 0x00000280B5440FE0>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000280B5569690>>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000280B5440040>
           │       │   └ <uvicorn.server.Server object at 0x00000280B5569690>
           │       └ <function run at 0x00000280B4BB7060>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000280B5574F20>
           │      └ <function Runner.run at 0x00000280B4D67560>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000280B4D64FE0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000280B4D64F40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000280B4D66D40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000280B4BB84A0>
    └ <Handle Task.task_wakeup(<Future finis...0280C8919250>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...0280C8919250>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...0280C8919250>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...0280C8919250>>)>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
          └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '55', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9940>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000280B7F4D9E0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000280C94E5050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000280B645F240>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000280C94F8360>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000280C950E650>
                     └ <function get_request_handler.<locals>.app at 0x00000280C94F8220>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000280B645D580>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x00000280C8919250>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x00000280C94F8180>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000280C94F2F50>

  File "D:\CampFrontClean\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x00000280C9491620>
                             └ <module 'strategist_llm_service' from 'D:\\CampFrontClean\\chatty\\strategist_llm_service.py'>

> File "D:\CampFrontClean\chatty\strategist_llm_service.py", line 159, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFrontClean\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 20:09:37.943 | INFO     | logging:callHandlers:1706 - 💬 Added turn 14 to conversation 14 - Query length: 18, Response length: 118
2025-07-08 20:11:30.827 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'campaxe' for conversation ID: 252764
2025-07-08 20:11:32.510 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 15
2025-07-08 20:11:33.344 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 20:11:33.344 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000280B30474C0>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000280B2D4D620>
           └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000280B2D4CB80>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000280B3020AD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    └ <function subprocess_started at 0x00000280B5440FE0>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000280B5569690>>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000280B5440040>
           │       │   └ <uvicorn.server.Server object at 0x00000280B5569690>
           │       └ <function run at 0x00000280B4BB7060>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000280B5574F20>
           │      └ <function Runner.run at 0x00000280B4D67560>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000280B4D64FE0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000280B4D64F40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000280B4D66D40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000280B4BB84A0>
    └ <Handle Task.task_wakeup(<Future finis...0280C9722AD0>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...0280C9722AD0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...0280C9722AD0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...0280C9722AD0>>)>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
          └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '44', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280C94F9800>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000280B7F4D9E0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000280C94E5050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9760>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000280B645F240>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000280C94F8360>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000280C9733050>
                     └ <function get_request_handler.<locals>.app at 0x00000280C94F8220>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000280B645D580>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x00000280C9722AD0>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x00000280C94F8180>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000280C94F2F50>

  File "D:\CampFrontClean\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x00000280C9491620>
                             └ <module 'strategist_llm_service' from 'D:\\CampFrontClean\\chatty\\strategist_llm_service.py'>

> File "D:\CampFrontClean\chatty\strategist_llm_service.py", line 159, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFrontClean\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 20:11:34.527 | INFO     | logging:callHandlers:1706 - 💬 Added turn 15 to conversation 15 - Query length: 7, Response length: 118
2025-07-08 20:17:47.444 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 364806
2025-07-08 20:17:49.340 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 16
2025-07-08 20:17:50.186 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 20:17:50.186 | ERROR    | logging:callHandlers:1706 - 🔥 An error occurred while communicating with the LLM: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x00000280B30474C0>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x00000280B2D4D620>
           └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000280B2D4CB80>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000280B3020AD0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
    │    └ <function subprocess_started at 0x00000280B5440FE0>
    └ <SpawnProcess name='SpawnProcess-1' parent=14076 started>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000280B5569690>>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000280B5440040>
           │       │   └ <uvicorn.server.Server object at 0x00000280B5569690>
           │       └ <function run at 0x00000280B4BB7060>
           └ <module 'asyncio' from 'C:\\Users\\mysel\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000280B5574F20>
           │      └ <function Runner.run at 0x00000280B4D67560>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\server.py...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000280B4D64FE0>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000280B5569090>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000280B4D64F40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000280B4D66D40>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000280B4BB84A0>
    └ <Handle Task.task_wakeup(<Future finis...0280C956F850>>)>
  File "C:\Users\mysel\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...0280C956F850>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...0280C956F850>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...0280C956F850>>)>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 426, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 84, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000280B5579E50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000280C9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
          └ <fastapi.applications.FastAPI object at 0x00000280C6AB6F50>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280B5543060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000280C94E7910>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '39', 'sec-ch-ua-platform': '"Android"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000280B5543060>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000280B7F4D9E0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000280C94E7C90>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000280C8F64190>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000280C94E5050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000280C94FF850>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000280B645F240>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000280C94F9800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000280C94F8360>
          └ APIRoute(path='/ask-strategist/', name='ask_marketing_strategist', methods=['POST'])
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000280C9730750>
                     └ <function get_request_handler.<locals>.app at 0x00000280C94F8220>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000280B645D580>
  File "D:\CampFrontClean\chatty\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.Session object at 0x00000280C956F850>, 'mode': 'auto', 'request': StrategistQueryRequest(query...
                 │         └ <function ask_marketing_strategist at 0x00000280C94F8180>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000280C94F2F50>

  File "D:\CampFrontClean\chatty\main.py", line 204, in ask_marketing_strategist
    text_response, _ = await strategist_llm_service.get_strategist_response(
                             │                      └ <function get_strategist_response at 0x00000280C9491620>
                             └ <module 'strategist_llm_service' from 'D:\\CampFrontClean\\chatty\\strategist_llm_service.py'>

> File "D:\CampFrontClean\chatty\strategist_llm_service.py", line 159, in get_strategist_response
    model = genai.GenerativeModel(
            │     └ <class 'google.generativeai.generative_models.GenerativeModel'>
            └ <module 'google.generativeai' from 'D:\\CampFrontClean\\chatty\\venv\\Lib\\site-packages\\google\\generativeai\\__init__.py'>

TypeError: GenerativeModel.__init__() got an unexpected keyword argument 'system_instruction'
2025-07-08 20:17:51.356 | INFO     | logging:callHandlers:1706 - 💬 Added turn 16 to conversation 16 - Query length: 2, Response length: 118
2025-07-08 20:20:42.114 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 531666
2025-07-08 20:20:48.031 | INFO     | logging:callHandlers:1706 - 📝 Created new conversation with ID: 17
2025-07-08 20:20:48.878 | INFO     | logging:callHandlers:1706 - 🎯 Auto-detected mode: conversation
2025-07-08 20:20:48.881 | INFO     | logging:callHandlers:1706 - 🧠 Sending conversation mode request to LLM with query and learnings.
2025-07-08 20:20:52.428 | INFO     | logging:callHandlers:1706 - ✅ Successfully received enhanced response from LLM.
2025-07-08 20:20:53.533 | INFO     | logging:callHandlers:1706 - 💬 Added turn 17 to conversation 17 - Query length: 2, Response length: 682
2025-07-09 04:46:28.784 | INFO     | logging:callHandlers:1706 - Received strategist query in auto mode: 'hi' for conversation ID: 363698
